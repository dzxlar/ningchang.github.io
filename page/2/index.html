<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="dzxblog">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="dzxblog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="dzxblog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>dzxblog</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  















  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">dzxblog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/31/【JVM】垃圾收集/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dzx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx2.sinaimg.cn/mw690/63b4ac8dgy1ffzs5lll1oj20zk0qoq4z.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dzxblog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/31/【JVM】垃圾收集/" itemprop="url">【JVM】垃圾收集</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-31T16:37:01+08:00">
                2017-08-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JVM/" itemprop="url" rel="index">
                    <span itemprop="name">JVM</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>【问题一】垃圾回收（GC）主要用在哪些区域</p>
<p>【回答】内存垃圾回收主要集中于 java 堆和方法区中。其他区域都是自动清理</p>
<p>【问题二】如何判断对象是否存活？</p>
<p>【回答】通常有2种方式。引用计数和可达性分析</p>
<p>  引用计数：每个对象有一个引用计数属性，新增一个引用时计数加1，引用释放时计数减1，计数为0时可以回收。此方法简单，无法解决对象相互循环引用的问题。</p>
<p>  可达性分析（Reachability Analysis）：从GC Roots开始向下搜索，搜索所走过的路径称为引用链。当一个对象到GC Roots没有任何引用链相连时，则证明此对象是不可用的。不可达对象。</p>
<p>【问题二延伸】描述GC Roots</p>
<p>【回答】在Java语言中，GC Roots包括：</p>
<ol>
<li><p>虚拟机栈中引用的对象。</p>
</li>
<li><p>方法区中类静态属性实体引用的对象。</p>
</li>
<li><p>方法区中常量引用的对象。</p>
</li>
<li><p>本地方法栈中JNI引用的对象。</p>
</li>
</ol>
<p>【问题三】简述几种常用标记算法？</p>
<p>【回答】</p>
<p>标记-清除算法(最基础)：首先标记出所有需要回收的对象，在标记完成后统一回收掉所有被标记的对象。</p>
<p>缺点：1.效率低下 2.产生不连续空间碎片（空间碎片太多可能会导致，当程序在以后的运行过程中需要分配较大对象时无法找到足够的连续内存而不得不提前触发另一次垃圾收集动作）</p>
<p>复制算法： ​将可用内存按容量划分为大小相等的两块，每次只使用其中的一块。当这一块的内存用完了，就将还存活着的对象复制到另外一块上面，然后再把已使用过的内存空间一次清理掉</p>
<p>缺点：虽然解决标记-清除算法产生不连续空间碎片问题。但是依旧效率不高（将内存缩小为原来的一半，持续复制长生存期的对象则导致效率降低）</p>
<p>标记-压缩算法：在对象存活率较高时就要执行较多的复制操作，效率将会变低（老年代不能直接选择这种算法）</p>
<p>分代收集算法：把Java堆分为新生代和老年代，这样就可以根据各个年代的特点采用最适当的收集算法(在新生代中，每次垃圾收集时都发现有大批对象死去，只有少量存活，那就选用复制算法，只需要付出少量存活对象的复制成本就可以完成收集。而老年代中因为对象存活率高、没有额外空间对它进行分配担保，就必须使用“标记-清理”或“标记-整理”算法来进行回收。)</p>
<p>【问题四】简述垃圾收集器的几个步骤</p>
<p>【回答】</p>
<p>1、标记阶段，首先初始标记(Initial-Mark),这个阶段是停顿的(Stop the World Event)，并且会触发一次普通Mintor GC。对应GC log:GC pause (young) (inital-mark)</p>
<p>2、Root Region Scanning，程序运行过程中会回收survivor区(存活到老年代)，这一过程必须在young GC之前完成。</p>
<p>3、Concurrent Marking，在整个堆中进行并发标记(和应用程序并发执行)，此过程可能被young GC中断。在并发标记阶段，若发现区域对象中的所有对象都是垃圾，那个这个区域会被立即回收(图中打X)。同时，并发标记过程中，会计算每个区域的对象活性(区域中存活对象的比例)。</p>
<p>4、Remark, 再标记，会有短暂停顿(STW)。再标记阶段是用来收集 并发标记阶段 产生新的垃圾(并发阶段和应用程序一同运行)；G1中采用了比CMS更快的初始快照算法:snapshot-at-the-beginning (SATB)。</p>
<p>5、Copy/Clean up，多线程清除失活对象，会有STW。G1将回收区域的存活对象拷贝到新区域，清除Remember Sets，并发清空回收区域并把它返回到空闲区域链表中。</p>
<p><a href="http://www.cnblogs.com/ityouknow/p/5614961.html" target="_blank" rel="external">http://www.cnblogs.com/ityouknow/p/5614961.html</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/23/JVM问题记录总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dzx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx2.sinaimg.cn/mw690/63b4ac8dgy1ffzs5lll1oj20zk0qoq4z.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dzxblog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/23/JVM问题记录总结/" itemprop="url">JVM问题记录总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-23T11:44:23+08:00">
                2017-08-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JVM/" itemprop="url" rel="index">
                    <span itemprop="name">JVM</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="【问题一】什么是类的加载？"><a href="#【问题一】什么是类的加载？" class="headerlink" title="【问题一】什么是类的加载？"></a>【问题一】什么是类的加载？</h2><p>【问题延伸】1. 如何访问方法区内的数据结构？ 2. 谈谈类加载机制 </p>
<p>【答案】首先理解类加载的概念：将.class文件中的二进制数据读取到内存中，放在运行时数据区的方法区内，在堆中创建一个java.lang.Class对象，封装方法区内的数据结构。所以该机制向程序猿通过该对象访问方法区中的这些数据提供了访问方法区内的数据结构的接口</p>
<h2 id="【问题二】-类加载有哪几种方式？"><a href="#【问题二】-类加载有哪几种方式？" class="headerlink" title="【问题二】 类加载有哪几种方式？"></a>【问题二】 类加载有哪几种方式？</h2><p>【答案】有5种方式。</p>
<ol>
<li>从本地系统中直接加载 2. 通过网络下载.class文件 3. 从zip，jar等归档文件中加载.class文件 4. 从专有数据库中提取.class文件 5. 将Java源文件动态编译为.class文件</li>
</ol>
<h2 id="【问题三】概述类的生命周期"><a href="#【问题三】概述类的生命周期" class="headerlink" title="【问题三】概述类的生命周期"></a>【问题三】概述类的生命周期</h2><p>【问题延伸】一个类从开始加载后会经历几个阶段？</p>
<p>【答案】生命周期一共经历7个阶段：类加载过程 -&gt; 卸载 -&gt; 使用</p>
<p>类加载阶段：加载 -&gt; 验证 -&gt; 准备 -&gt; 解析 -&gt; 初始化</p>
<p>在类加载阶段中，除解析阶段，其它阶段的过程顺序是确定的。而解析，可以在初始化阶段之后开始，为了支持Java语言的动态绑定。但是这4个阶段是按顺序开始，换句话说就是这些阶段通常都是互相交叉地混合进行的，通常在一个阶段执行的过程中调用或激活另一个阶段</p>
<p>详解每个阶段的处理过程</p>
<ol>
<li><p>加载：查找并加载类的二进制数据</p>
<p>  i、通过一个类的全限定名来获取其定义的二进制字节流。</p>
<p>  ii、将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构。</p>
<p>  iii、在Java堆中生成一个代表这个类的java.lang.Class对象，作为对方法区中这些数据的访问入口。</p>
</li>
</ol>
<ol>
<li><p>连接</p>
<p> 2.1. 验证：确保被加载的类的正确性</p>
<pre><code> i. 文件格式验证：验证字节流是否符合Class文件格式的规范；例如：是否以0xCAFEBABE开头、主次版本号是否在当前虚拟机的处理范围之内、常量池中的常量是否有不被支持的类型。

 ii. 元数据验证：对字节码描述的信息进行语义分析（注意：对比javac编译阶段的语义分析），以保证其描述的信息符合Java语言规范的要求；例如：这个类是否有父类，除了java.lang.Object之外。

iii. 字节码验证：通过数据流和控制流分析，确定程序语义是合法的、符合逻辑的。

iiii. 符号引用验证：确保解析动作能正确执行。
</code></pre><p> 2.2. 准备： 为类的静态变量分配内存，并将其初始化为默认值</p>
<pre><code>i. 这时候进行内存分配的仅包括类变量（static），而不包括实例变量，实例变量会在对象实例化时随着对象一块分配在Java堆中。

ii. 这里所设置的初始值通常情况下是数据类型默认的零值（如0、0L、null、false等），而不是被在Java代码中被显式地赋予的值。
</code></pre></li>
</ol>
<p>假设一个类变量的定义为：public static int value = 3；那么变量value在准备阶段过后的初始值为0，而不是3，因为这时候尚未开始执行任何Java方法，而把value赋值为3的putstatic指令是在程序编译后，存放于类构造器<clinit>（）方法之中的，所以把value赋值为3的动作将在初始化阶段才会执行。</clinit></p>
<p>注意：</p>
<ol>
<li><p>对基本数据类型来说，对于类变量（static）和全局变量，如果不显式地对其赋值而直接使用，则系统会为其赋予默认的零值，而对于局部变量来说，在使用前必须显式地为其赋值，否则编译时不通过。</p>
</li>
<li><p>对于同时被static和final修饰的常量，必须在声明的时候就为其显式地赋值，否则编译时不通过；而只被final修饰的常量则既可以在声明时显式地为其赋值，也可以在类初始化时显式地为其赋值，总之，在使用前必须为其显式地赋值，系统不会为其赋予默认零值。</p>
</li>
<li><p>对于引用数据类型reference来说，如数组引用、对象引用等，如果没有对其进行显式地赋值而直接使用，系统都会为其赋予默认的零值，即null。</p>
</li>
<li><p>如果在数组初始化时没有对数组中的各元素赋值，那么其中的元素将根据对应的数据类型而被赋予默认的零值。</p>
</li>
</ol>
<p>假设上面的类变量value被定义为： public static final int value = 3；编译时Javac将会为value生成ConstantValue属性，在准备阶段虚拟机就会根据ConstantValue的设置将value赋值为3</p>
<ol>
<li>解析：把类中的符号引用转换为直接引用</li>
</ol>
<p>解析阶段是虚拟机将常量池内的符号引用替换为直接引用的过程，解析动作主要针对类或接口、字段、类方法、接口方法、方法类型、方法句柄和调用点限定符7类符号引用进行。</p>
<p>符号引用就是一组符号来描述目标，可以是任何字面量。</p>
<p>直接引用就是直接指向目标的指针、相对偏移量或一个间接定位到目标的句柄。</p>
<ol>
<li>初始化</li>
</ol>
<p>初始化，为类的静态变量赋予正确的初始值，JVM负责对类进行初始化，主要对类变量进行初始化。在Java中对类变量进行初始值设定有两种方式：</p>
<p>  ①声明类变量时指定初始值</p>
<p>  ②使用静态代码块为类变量指定初始值</p>
<p>JVM初始化步骤</p>
<ol>
<li><p>假如这个类还没有被加载和连接，则程序先加载并连接该类</p>
</li>
<li><p>假如该类的直接父类还没有被初始化，则先初始化其直接父类</p>
</li>
<li><p>假如类中有初始化语句，则系统依次执行这些初始化语句</p>
</li>
</ol>
<p>类初始化时机：只有当对类的主动使用的时候才会导致类的初始化</p>
<p>类使用的6种方式</p>
<p>– 创建类的实例，也就是new的方式</p>
<p>– 访问某个类或接口的静态变量，或者对该静态变量赋值</p>
<p>– 调用类的静态方法</p>
<p>– 反射（如Class.forName(“com.test.TestMain”)）</p>
<p>– 初始化某个类的子类，则其父类也会被初始化</p>
<p>– Java虚拟机启动时被标明为启动类的类（Java Test），直接使用java.exe命令来运行某个主类</p>
<ol>
<li>结束生命周期</li>
</ol>
<p>– 执行了System.exit()方法</p>
<p>– 程序正常执行结束</p>
<p>– 程序在执行过程中遇到了异常或错误而异常终止</p>
<p>– 由于操作系统出现错误而导致Java虚拟机进程终止</p>
<h2 id="【问题四】类加载器有几种？"><a href="#【问题四】类加载器有几种？" class="headerlink" title="【问题四】类加载器有几种？"></a>【问题四】类加载器有几种？</h2><p>【回答】总的概括为3种：启动类加载器(Bootstrap ClassLoader)、扩展类加载器(Extension ClassLoader)、应用程序类加载器(Application ClassLoader) *默认的类加载器</p>
<p>可以​实现自定义类加载器(优点：1. 在执行非置信代码之前，自动验证数字签名。2. 动态地创建符合用户特定需要的定制化构建类。 3. 从特定的场所取得java class，例如数据库中和网络中)</p>
<h2 id="【问题5】谈谈类加载机制？"><a href="#【问题5】谈谈类加载机制？" class="headerlink" title="【问题5】谈谈类加载机制？"></a>【问题5】谈谈类加载机制？</h2><p>【回答】全盘负责、父类委托、缓存机制。</p>
<p>•全盘负责，当一个类加载器负责加载某个Class时，该Class所依赖的和引用的其他Class也将由该类加载器负责载入，除非显示使用另外一个类加载器来载入</p>
<p>•父类委托，先让父类加载器试图加载该类，只有在父类加载器无法加载该类时才尝试从自己的类路径中加载该类</p>
<p>•缓存机制，缓存机制将会保证所有加载过的Class都会被缓存，当程序中需要使用某个Class时，类加载器先从缓存区寻找该Class，只有缓存区不存在，系统才会读取该类对应的二进制数据，并将其转换成Class对象，存入缓存区。这就是为什么修改了Class后，必须重启JVM，程序的修改才会生效</p>
<h2 id="【问题6】类加载有几种方式？"><a href="#【问题6】类加载有几种方式？" class="headerlink" title="【问题6】类加载有几种方式？"></a>【问题6】类加载有几种方式？</h2><p>【回答】3种。</p>
<p>ClassLoader loader = HelloWorld.class.getClassLoader(); </p>
<p>1、命令行启动应用时候由JVM初始化加载</p>
<p>2、通过Class.forName()方法动态加载</p>
<pre><code>默认会执行初始化块 
</code></pre><p> Class.forName(“Test”, false, loader); </p>
<p>3、通过ClassLoader.loadClass()方法动态加载</p>
<pre><code>初始化时不执行静态块 
</code></pre><p>loader.loadClass(“Test”); </p>
<h2 id="【问题七】谈谈Class-forName-和ClassLoader-loadClass-区别？"><a href="#【问题七】谈谈Class-forName-和ClassLoader-loadClass-区别？" class="headerlink" title="【问题七】谈谈Class.forName()和ClassLoader.loadClass()区别？"></a>【问题七】谈谈Class.forName()和ClassLoader.loadClass()区别？</h2><p>【回答】Class.forName()：将类的.class文件加载到jvm中之外，还会对类进行解释，执行类中的static块；ClassLoader.loadClass()：只干一件事情，就是将.class文件加载到jvm中，不会执行static中的内容,只有在newInstance才会去执行static块。</p>
<p>Class.forName(name, initialize, loader)带参函数也可控制是否加载static块。并且只有调用了newInstance()方法采用调用构造函数，创建类的对象 。</p>
<h2 id="【问题八】什么是双亲委派模型？"><a href="#【问题八】什么是双亲委派模型？" class="headerlink" title="【问题八】什么是双亲委派模型？"></a>【问题八】什么是双亲委派模型？</h2><p>【回答】如果一个类加载器收到了类加载的请求，它首先不会自己去尝试加载这个类，而是把请求委托给父加载器去完成，依次向上，因此，所有的类加载请求最终都应该被传递到顶层的启动类加载器中，只有当父加载器在它的搜索范围中没有找到所需的类时，即无法完成该加载，子加载器才会尝试自己去加载该类</p>
<h2 id="【问题九】双亲委派模型意义？"><a href="#【问题九】双亲委派模型意义？" class="headerlink" title="【问题九】双亲委派模型意义？"></a>【问题九】双亲委派模型意义？</h2><p>【回答】</p>
<p>-系统类防止内存中出现多份同样的字节码</p>
<p>-保证Java程序安全稳定运行</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="http://www.cnblogs.com/ityouknow/p/5603287.html" target="_blank" rel="external">http://www.cnblogs.com/ityouknow/p/5603287.html</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/22/【JVM调优】工具/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dzx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx2.sinaimg.cn/mw690/63b4ac8dgy1ffzs5lll1oj20zk0qoq4z.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dzxblog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/22/【JVM调优】工具/" itemprop="url">【JVM调优】工具</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-22T10:34:48+08:00">
                2017-08-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JVM/" itemprop="url" rel="index">
                    <span itemprop="name">JVM</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="jps"><a href="#jps" class="headerlink" title="jps"></a>jps</h2><blockquote>
<p>输出JVM中运行的进程状态信息</p>
</blockquote>
<pre><code>jps [options] [host]
</code></pre><ul>
<li>host 默认本机地址</li>
<li><p>options</p>
<pre><code>-q 不输出类名、Jar名和传入main方法的参数
-m 输出传入main方法的参数
-l 输出main类或Jar的全限名
-v 输出传入JVM的参数
</code></pre></li>
</ul>
<h2 id="jstack"><a href="#jstack" class="headerlink" title="jstack"></a>jstack</h2><blockquote>
<p>查看某个Java进程内的线程堆栈信息</p>
</blockquote>
<pre><code>jstack [option] pid
jstack [option] executable core
jstack [option] [server-id@]remote-hostname-or-ip
</code></pre><ul>
<li>-l，会打印出额外的锁信息，在发生死锁时可以用jstack -l pid来观察锁持有情况</li>
<li>-m，不仅会输出Java堆栈信息，还会输出C/C++堆栈信息（比如Native方法）</li>
</ul>
<p><strong> jstack可以定位到线程堆栈，根据堆栈信息我们可以定位到具体代码，所以它在JVM性能调优中使用得非常多</strong></p>
<h3 id="调试步骤"><a href="#调试步骤" class="headerlink" title="调试步骤"></a>调试步骤</h3><ol>
<li><p>找到项目进程</p>
<pre><code>ps -ef | grep mrf-center | grep -v grep
</code></pre></li>
<li><p>找出该进程内最耗费CPU的线程</p>
<pre><code>ps -Lfp pid
ps -mp pid -o THREAD, tid, time
top -Hp pid
</code></pre></li>
<li><p>得到进程耗费CPU时间的十六进制pid</p>
<pre><code>printf &quot;%x\n&quot; pid
</code></pre></li>
<li><p>得到进程pid的堆栈信息</p>
<pre><code>jstack 21711 | grep 16进制pid
</code></pre></li>
</ol>
<h2 id="jmap"><a href="#jmap" class="headerlink" title="jmap"></a>jmap</h2><blockquote>
<p>查看堆内存使用状况，一般结合jhat使用</p>
</blockquote>
<pre><code>jmap [option] pid
jmap [option] executable core
jmap [option] [server-id@]remote-hostname-or-ip
</code></pre><p><strong>注意：64位JVM需要指定-J-d64参数</strong></p>
<p>打印进程的类加载器和类加载器加载的持久代对象信息，输出：类加载器名称、对象是否存活（不可靠）、对象地址、父类加载器、已加载的类大小等信息</p>
<pre><code>jmap -permstat pid
</code></pre><p>  使用jmap -heap pid查看进程堆内存使用情况，包括使用的GC算法、堆配置参数和各代中堆内存使用情况</p>
<pre><code>jmap -heap pid
</code></pre><p> 查看堆内存中的对象数目、大小统计直方图，如果带上live则只统计活对象</p>
<pre><code>jmap -histo:live pid | more
</code></pre><p>  用jmap把进程内存使用情况dump到文件中，再用jhat分析查看</p>
<pre><code>jmap -dump:format=b,file=/tmp/dump.dat pid

 jhat -port 9998 /tmp/dump.dat
</code></pre><p>  <strong>如果Dump文件太大，可能需要加上-J-Xmx512m这种参数指定最大堆内存，即jhat -J-Xmx512m -port 9998 /tmp/dump.dat。然后就可以在浏览器中输入主机地址:9998</strong></p>
<h2 id="jstat"><a href="#jstat" class="headerlink" title="jstat"></a>jstat</h2><pre><code>jstat [ generalOption | outputOptions vmid [interval[s|ms] [count]] ]
</code></pre><p>vmid是Java虚拟机ID，在Linux/Unix系统上一般就是进程ID。interval是采样时间间隔。count是采样数目</p>
<pre><code>jstat -gc pid time count
</code></pre><hr>
<p> <strong> 堆内存 = 年轻代 + 年老代 + 永久代<br>年轻代 = Eden区 + 两个Survivor区（From和To）</strong></p>
<p>S0C、S1C、S0U、S1U：Survivor 0/1区容量（Capacity）和使用量（Used）<br>EC、EU：Eden区容量和使用量<br>OC、OU：年老代容量和使用量<br>PC、PU：永久代容量和使用量<br>YGC、YGT：年轻代GC次数和GC耗时<br>FGC、FGCT：Full GC次数和Full GC耗时<br>GCT：GC总耗时</p>
<hr>
<h2 id="hprof"><a href="#hprof" class="headerlink" title="hprof"></a>hprof</h2><blockquote>
<p>展现CPU使用率，统计堆内存使用情况</p>
</blockquote>
<pre><code>java -agentlib:hprof[=options] ToBeProfiledClass
java -Xrunprof[:options] ToBeProfiledClass
javac -J-agentlib:hprof[=options] ToBeProfiledClass    
</code></pre><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a href="https://my.oschina.net/feichexia/blog/196575" target="_blank" rel="external">开源中国</a><br><a href="http://www.ityouknow.com/java/2017/02/22/jvm-tool.html" target="_blank" rel="external">博客参考</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/17/hashCode/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dzx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx2.sinaimg.cn/mw690/63b4ac8dgy1ffzs5lll1oj20zk0qoq4z.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dzxblog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/17/hashCode/" itemprop="url">hashCode()</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-17T16:19:33+08:00">
                2017-08-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/源码/" itemprop="url" rel="index">
                    <span itemprop="name">源码</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><pre><code>/**
 *  计算公式
 * s[0]*31^(n-1) + s[1]*31^(n-2) + ... + s[n-1]
 */
 public int hashCode() {
     int h = hash;
     if (h == 0 &amp;&amp; value.length &gt; 0) {
         char val[] = value;
         for (int i = 0; i &lt; value.length; i++) {
             h = 31 * h + val[i];
         }
         hash = h;
     }
     return h;
 }
</code></pre><h1 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h1><blockquote>
<p>根据一定的规则将与对象相关的信息（比如对象的存储地址，对象的字段等）映射成一个数值，这个数值称作为散列值</p>
</blockquote>
<p><strong>注意:虽然不能根据hashcode值判断两个对象是否相等，但是可以直接根据hashcode值判断两个对象不等，如果两个对象的hashcode值不等，则必定是两个不同的对象。如果要判断两个对象是否真正相等，必须通过equals方法</strong></p>
<ul>
<li>如果equals()相等，hashCode()一定相等</li>
<li>如果equals()不等，hashCode()一定不等</li>
<li>如果hashCode()不等，equals()一定不等</li>
<li>如果hashCode()相等，equals()不一定相等</li>
</ul>
<h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><p><a href="https://my.oschina.net/u/3624220/blog/1512125" target="_blank" rel="external">hashCode和equals</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/17/Https学习笔记-一/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dzx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx2.sinaimg.cn/mw690/63b4ac8dgy1ffzs5lll1oj20zk0qoq4z.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dzxblog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/17/Https学习笔记-一/" itemprop="url">Https学习笔记(一)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-17T10:33:03+08:00">
                2017-08-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Https-与-Http-基本概念"><a href="#Https-与-Http-基本概念" class="headerlink" title="Https 与 Http 基本概念"></a>Https 与 Http 基本概念</h1><p>HTTP：是互联网上应用最为广泛的一种网络协议，是一个客户端和服务器端请求和应答的标准（TCP），用于从WWW服务器传输超文本到本地浏览器的传输协议，它可以使浏览器更加高效，使网络传输减少。</p>
<p>HTTPS：是以安全为目标的HTTP通道，简单讲是HTTP的安全版，即HTTP下加入SSL层，<strong>HTTPS的安全基础是SSL</strong>，因此加密的详细内容就需要SSL。</p>
<p>HTTPS协议的主要作用可以分为两种：<strong>一种是建立一个信息安全通道，来保证数据传输的安全；另一种就是确认网站的真实性。</strong></p>
<h1 id="Https-与-Http-的区别"><a href="#Https-与-Http-的区别" class="headerlink" title="Https 与 Http 的区别"></a>Https 与 Http 的区别</h1><p>1、https协议需要到ca申请证书，一般免费证书较少，因而需要一定费用。</p>
<p>2、http是超文本传输协议，信息是明文传输，https则是具有安全性的ssl加密传输协议。</p>
<p>3、http和https使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。</p>
<p>4、http的连接很简单，是无状态的；HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，比http协议安全。</p>
<h1 id="Https原理"><a href="#Https原理" class="headerlink" title="Https原理"></a>Https原理</h1><p><img src="http://www.mahaixiang.cn/uploads/allimg/1507/1-150H120343I41.jpg" alt="https原理"></p>
<h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><p><a href="http://www.cnblogs.com/wqhwe/p/5407468.html" target="_blank" rel="external">Https和Http的区别</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/17/Querydsl学习笔记-一/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dzx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx2.sinaimg.cn/mw690/63b4ac8dgy1ffzs5lll1oj20zk0qoq4z.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dzxblog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/17/Querydsl学习笔记-一/" itemprop="url">Querydsl学习笔记(一)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-17T10:28:07+08:00">
                2017-08-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/querydsl/" itemprop="url" rel="index">
                    <span itemprop="name">querydsl</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="引用POM"><a href="#引用POM" class="headerlink" title="引用POM"></a>引用POM</h1><pre><code>&lt;dependency&gt;
  &lt;groupId&gt;com.querydsl&lt;/groupId&gt;
  &lt;artifactId&gt;querydsl-jpa&lt;/artifactId&gt;
  &lt;version&gt;${querydsl.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
  &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
  &lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
  &lt;version&gt;1.6.1&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
  &lt;groupId&gt;com.querydsl&lt;/groupId&gt;
  &lt;artifactId&gt;querydsl-apt&lt;/artifactId&gt;
  &lt;version&gt;${querydsl.version}&lt;/version&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre><h1 id="引入插件"><a href="#引入插件" class="headerlink" title="引入插件"></a>引入插件</h1><pre><code>&lt;plugin&gt;
  &lt;groupId&gt;com.mysema.maven&lt;/groupId&gt;
  &lt;artifactId&gt;apt-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;1.1.3&lt;/version&gt;
  &lt;executions&gt;
    &lt;execution&gt;
      &lt;goals&gt;
        &lt;goal&gt;process&lt;/goal&gt;
      &lt;/goals&gt;
      &lt;configuration&gt;
        &lt;outputDirectory&gt;target/generated-sources/java&lt;/outputDirectory&gt;
        &lt;processor&gt;com.querydsl.apt.jpa.JPAAnnotationProcessor&lt;/processor&gt;
      &lt;/configuration&gt;
    &lt;/execution&gt;
  &lt;/executions&gt;
&lt;/plugin&gt;                
</code></pre><h2 id="实体"><a href="#实体" class="headerlink" title="实体"></a>实体</h2><pre><code>  @Data
@Entity
public class Article{
            private Integer id;
            private Integer tag; 
            private String title;
            private String subtitle;
            private String content;
            private String author;
            private Integer likeCount;
            private Integer collectCount;
            private String createTime;
}

@Data
@Entity
public class Tag{
            private Integer id;
            private String name;
            private String createTime;
}
</code></pre><p>Querydsl生成查询类型QXxxx包装实体对象Xxxx，作为静态类型变量的代表</p>
<pre><code>QArticle article = QArticle.article;
QTag tag = new QTag(&quot;tag&quot;);
</code></pre><p>Querydsl支持JPA和hibernateAPI</p>
<pre><code>JPAQuery&lt;?&gt; query = new JPAQuery&lt;Void&gt;(entityManager);
HibernateQuery&lt;?&gt; query = new HibernateQuery&lt;Void&gt;(session);
</code></pre><p>JPAQuery和HibernateQUery实现JPQLQuery接口</p>
<h2 id="构建JPAQueryFactory实例"><a href="#构建JPAQueryFactory实例" class="headerlink" title="构建JPAQueryFactory实例"></a>构建JPAQueryFactory实例</h2><pre><code>  @Bean
public JPAQueryFactory queryFactory(EntityManager entityManager) {
    return new JPAQueryFactory(new HQLTemplates(), entityManager);
}
</code></pre><h2 id="用法实例"><a href="#用法实例" class="headerlink" title="用法实例"></a>用法实例</h2><h3 id="fetchOne返回单条数据"><a href="#fetchOne返回单条数据" class="headerlink" title="fetchOne返回单条数据"></a>fetchOne返回单条数据</h3><pre><code>// select * from Article as article where title = &quot;hello world&quot;; 
Article article = queryFactory.selectFrom(article)
                                                    .where(article.title,eq(&quot;hello world&quot;))
                                                    .fetchOne();
</code></pre><h3 id="多数据源查询"><a href="#多数据源查询" class="headerlink" title="多数据源查询"></a>多数据源查询</h3><pre><code>// select * from article,tag;
query.from(article,tag);
</code></pre><h3 id="多条件查询"><a href="#多条件查询" class="headerlink" title="多条件查询"></a>多条件查询</h3><pre><code>// select * from Article as article where article.title = &quot;hello world&quot; and article.subtitle=&quot;querydsl&quot;; 
Article article = queryFactory.selectFrom(article)
                              .where(article.title,eq(&quot;hello world&quot;),and(artitle.subtitle,eq(&quot;querydsl&quot;)))
</code></pre><h3 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h3><pre><code>// select * from Article as article inner join Tag as tag on tag.id = article.tag where tag.name = &apos;tagName&apos;
queryFactory.selectFrom(article)
            .innerJoin(article.tag,tag)
           //.leftJoin(article.tag,tag)
            .on(tag.name.eq(&quot;tagName&quot;))
            .fetch();  
</code></pre><h3 id="一般处理业务的API"><a href="#一般处理业务的API" class="headerlink" title="一般处理业务的API"></a>一般处理业务的API</h3><ul>
<li>select</li>
<li>from</li>
<li>innerJoin </li>
<li>where</li>
<li>groupBy</li>
<li>having</li>
<li>orderBy</li>
<li>limit</li>
<li>like</li>
</ul>
<h3 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h3><pre><code>//select * from Article as article order by article.id asc,article.tag desc;
queryFactory.selectFrom(article)
            .orderyBy(article.id.asc(),article.tag.desc())
            .fetch();
</code></pre><h3 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h3><pre><code>//select * from Article as article group by article.tag;
queryFactory.selectFrom(article)
            .groupBy(article.tag)
            .fetch();
</code></pre><h3 id="CRUD"><a href="#CRUD" class="headerlink" title="CRUD"></a>CRUD</h3><h4 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h4><pre><code>queryFactory.delete(article).execute();
queryFactory.delete(article).where(article.tag,&quot;tagName&quot;).execute();
</code></pre><h4 id="update"><a href="#update" class="headerlink" title="update"></a>update</h4><pre><code>queryFactory.update(article)
            .where(article.id,eq(1))
            .set(article.title,&quot;updateTitle&quot;)
            .execute();
</code></pre><h4 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h4><pre><code>queryFactory.update(article)
            .where(article.likeCount.eq(
               JPAExpressions.select(article.likeCount.max()).from(artile)
             ))
             .fetch()l
</code></pre><h4 id="改变结构"><a href="#改变结构" class="headerlink" title="改变结构"></a>改变结构</h4><pre><code>Query jpaQuery = queryFactory.selectFrom(article).createQuery();
 results = jpaQuery.getResultList();
</code></pre><h4 id="使用JPA或者本地查询"><a href="#使用JPA或者本地查询" class="headerlink" title="使用JPA或者本地查询"></a>使用JPA或者本地查询</h4><pre><code>&lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;com.querydsl&lt;/groupId&gt;
        &lt;artifactId&gt;querydsl-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;${querydsl.version}&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;goals&gt;
              &lt;goal&gt;export&lt;/goal&gt;
            &lt;/goals&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
        &lt;configuration&gt;
          &lt;jdbcDriver&gt;org.apache.derby.jdbc.EmbeddedDriver&lt;/jdbcDriver&gt;
          &lt;jdbcUrl&gt;jdbc:derby:target/demoDB;create=true&lt;/jdbcUrl&gt;
          &lt;packageName&gt;com.mycompany.mydomain&lt;/packageName&gt;
          &lt;targetFolder&gt;${project.basedir}/target/generated-sources/java&lt;/targetFolder&gt;
        &lt;/configuration&gt;
        &lt;dependencies&gt;
          &lt;dependency&gt;
            &lt;groupId&gt;org.apache.derby&lt;/groupId&gt;
            &lt;artifactId&gt;derby&lt;/artifactId&gt;
            &lt;version&gt;${derby.version}&lt;/version&gt;
          &lt;/dependency&gt;
        &lt;/dependencies&gt;
      &lt;/plugin&gt;
</code></pre><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><p><a href="http://www.querydsl.com/" target="_blank" rel="external">官网</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/14/【Java爬虫】Jsoup学习笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dzx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx2.sinaimg.cn/mw690/63b4ac8dgy1ffzs5lll1oj20zk0qoq4z.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dzxblog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/14/【Java爬虫】Jsoup学习笔记/" itemprop="url">【Java爬虫】Jsoup学习笔记</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-14T11:34:42+08:00">
                2017-08-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Jsoup/" itemprop="url" rel="index">
                    <span itemprop="name">Jsoup</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="简单demo"><a href="#简单demo" class="headerlink" title="简单demo"></a>简单demo</h1><pre><code>try {
    //获取需要爬取的网络地址
    Document doc = Jsoup.connect(&quot;https://www.oschina.net/blog&quot;).get();
    String title = doc.title();
    System.out.println(title);
    //类似jQuery的选择符
    Elements elements = doc.select(&quot;.box-aw&quot;);
    //遍历循环
    Iterator&lt;Element&gt; iter = elements.iterator();
    while(iter.hasNext()){
        Element element = iter.next();
        System.out.println(element.select(&quot;h2.blog-name&quot;).text());
        System.out.println(element.select(&quot;section.blog-brief&quot;).text());
        System.out.println(element.select(&quot;footer.blog-footer-box&quot;).text());
    }
} catch (IOException e) {
    e.printStackTrace();
}
</code></pre><h1 id="得到结果"><a href="#得到结果" class="headerlink" title="得到结果"></a>得到结果</h1><pre><code>   微服务架构
微服务架构 微服务是系统架构上的设计风格，主旨是将一个原本独立的系统拆分成多个小型服务，这些小型服务都在各自独立的进程中运行，服务之间通过基于http的RESTful AP进行通信协作。被拆分成的每一个小型服务都围绕着系统中的某一项或一些耦合度较高的业务功能进行构建，并且每个服务都维护着自身的数据存储、业务开发、自动化测试案例以及独立部署机制。 与单体系统的区别 传统的企业系统中，针对一个复杂的业务需求通常使用对象或业务类型来构建一个单体项目。 在项目中通常将需求分为三个主要部分：数据库、服务端处理、前端展现。在业务发展初期，由于所有的业务逻辑在一个应用中，开发、测试、部署、都比较容易方便。但是企业发展，系统为了应对不同的业务需求会不断为该单体项目增加不同的业务模块；同时随着移动端设备的进步，前端展现模块已经不仅局限于web的形式，这对于系统后端向前端的支持需要更多的接口模块。单体应用由于面对的业务需求更为宽泛，不断扩大的需求会使得单体应用变得越来越臃肿。单体应用的问题就逐渐凸显出来，由于单体系统部署在一个进程中，如果修改了一个小的功能，为了部署上线会影响其他的功能运行。并且单体应用中的这些功能模块的使...
    yangty2017 发布于 3天前 阅读 138
</code></pre><h1 id="如何获取JSON数据"><a href="#如何获取JSON数据" class="headerlink" title="如何获取JSON数据"></a>如何获取JSON数据</h1><pre><code>Response result = Jsoup.connect(HttpUrl)
               .header(&quot;accept&quot;, &quot;application/json, text/plain, */*&quot;)
               .header(&quot;Accept-Encoding&quot;, &quot;gzip, deflate, br&quot;)
               .header(&quot;Accept-Language&quot;, &quot;zh-CN,zh;q=0.8&quot;)
               .header(&quot;Content-Type&quot;, &quot;application/json;charset=UTF-8&quot;)
               .header(&quot;Host&quot;, &quot;www.zhihu.com&quot;)
               .header(&quot;authorization&quot;, &quot;Bearer Mi4xb2NlWUF3QUFBQUFBRUlLdG1SNDlEQmNBQUFCaEFsVk5EbERjV2dDZGp1SzlYX2ZXLWE4Y2tGMDd5VndqbXRuNG5B|1508835854|9f6e06f9ec3699813204f7dcfbce40ea7b746029&quot;)
               .timeout(3000)
               .ignoreContentType(true)
               .execute();
</code></pre><h1 id="如何从网上下载图片"><a href="#如何从网上下载图片" class="headerlink" title="如何从网上下载图片"></a>如何从网上下载图片</h1><pre><code>     public static void downloadImages(String filePath,String imgUrl) throws UnsupportedEncodingException {  

    String beforeUrl = imgUrl.substring(0,imgUrl.lastIndexOf(&quot;/&quot;)+1);  
    String fileName = imgUrl.substring(imgUrl.lastIndexOf(&quot;/&quot;)+1);  
    String newFileName = URLEncoder.encode(fileName, &quot;UTF-8&quot;);  
    newFileName = newFileName.replaceAll(&quot;\\+&quot;, &quot;\\%20&quot;);  
    imgUrl = beforeUrl + newFileName;  

    try {  
        File files = new File(filePath);  
        if (!files.exists()) {  
            files.mkdirs();  
        }  
        URL url = new URL(imgUrl);  
        HttpURLConnection connection = (HttpURLConnection)url.openConnection();  
        InputStream is = connection.getInputStream();  
        File file = new File(filePath + fileName);  
        FileOutputStream out = new FileOutputStream(file);  
        int i = 0;  
        while((i = is.read()) != -1){  
            out.write(i);  
        }  
        out.close();  
        is.close();  
    } catch (Exception e) {  
        e.printStackTrace();  
    }  
}  
</code></pre><h1 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h1><p>   <a href="https://jsoup.org/cookbook/" target="_blank" rel="external">Jsoup官网</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/28/【Java源码】String字符串/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dzx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx2.sinaimg.cn/mw690/63b4ac8dgy1ffzs5lll1oj20zk0qoq4z.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dzxblog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/28/【Java源码】String字符串/" itemprop="url">【Java源码】String字符串</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-28T15:35:29+08:00">
                2017-07-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/String/" itemprop="url" rel="index">
                    <span itemprop="name">String</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="String特性"><a href="#String特性" class="headerlink" title="String特性"></a>String特性</h1><ul>
<li><p>通过final修饰(Java7以后说明：final类方法永远不会被重写)</p>
<pre><code>public final class String{...}
</code></pre></li>
<li><p>String为不可变性（不可通过正常手段修改值）</p>
<pre><code>- 通过substring方法作为代表
        public String substring(int beginIndex) {
            if (beginIndex &lt; 0) {
                throw new StringIndexOutOfBoundsException(beginIndex);
            }
            int subLen = value.length - beginIndex;
            if (subLen &lt; 0) {
                throw new StringIndexOutOfBoundsException(subLen);
            }
            //通过重新创建String对象修改值
            return (beginIndex == 0) ? this : new String(value, beginIndex, subLen);
        }
</code></pre><h2 id="不可变的好处"><a href="#不可变的好处" class="headerlink" title="不可变的好处"></a>不可变的好处</h2></li>
</ul>
<ol>
<li>可以实现多个变量引用JVM内存中的同一个字符串实例。</li>
<li>安全性</li>
<li>性能，String大量运用在哈希的处理中，由于String的不可变性，只计算一次哈希值，然后缓存在内部，后续直接取值</li>
</ol>
<blockquote>
<p><strong>设计成不可变后，可以多个变量引用JVM上同一块地址,可以节省内存空间，相同的字符串不用重复占用Heap区域空间</strong></p>
</blockquote>
<h2 id="拼接字符串"><a href="#拼接字符串" class="headerlink" title="拼接字符串"></a>拼接字符串</h2><ol>
<li><p>不推荐”+”号拼接</p>
<p> 每次循环都会创建一个StringBuilder，在末尾再调用toString返还回去</p>
</li>
<li><p>推荐append方法</p>
</li>
<li><p>StringBuffer线程安全、StringBuilder非线程安全</p>
</li>
</ol>
<p><a href="https://my.oschina.net/kailuncen/blog/1483860" target="_blank" rel="external">参考</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/10/PHP学习笔记-一-——-入门环境搭建/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dzx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx2.sinaimg.cn/mw690/63b4ac8dgy1ffzs5lll1oj20zk0qoq4z.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dzxblog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/10/PHP学习笔记-一-——-入门环境搭建/" itemprop="url">PHP学习笔记(一) —— 入门环境搭建</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-10T10:52:31+08:00">
                2017-07-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/php/" itemprop="url" rel="index">
                    <span itemprop="name">php</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>题外话:由于公司DMS管理系统是第三方php写的，现在需要进行二次开发。所以了解了一下一些基本php搭建环境、基本框架语法等知识点</p>
</blockquote>
<h1 id="搭建准备环境"><a href="#搭建准备环境" class="headerlink" title="搭建准备环境"></a>搭建准备环境</h1><blockquote>
<p>独立安装各模块顺序按照Apache—&gt;PHP—&gt;MySQL进行。集成安装环境则不用</p>
</blockquote>
<ul>
<li><a href="http://httpd.apache.org/docs/current/platform/windows.html#down" target="_blank" rel="external">Apache</a></li>
<li><a href="https://www.mysql.com/" target="_blank" rel="external">MySQL</a></li>
<li><a href="http://windows.php.net/download#php-5.6" target="_blank" rel="external">PHP</a></li>
<li><a href="http://www.wampserver.com/" target="_blank" rel="external">集成安装环境-wampsever</a></li>
</ul>
<h1 id="安装Httpd"><a href="#安装Httpd" class="headerlink" title="安装Httpd"></a>安装Httpd</h1><ol>
<li>下载ApacheHaus并且解压</li>
<li>管理员身份运行命令行进入 ${ApachePath}/bin</li>
<li>运行httpd -k install安装</li>
</ol>
<p>安装过程报错问题</p>
<ol>
<li><p>项目路径失效。解决方案：打开conf/httpd.conf，修改</p>
<pre><code>Define SRVROOT &quot;G:\php\httpd\Apache24&quot;
ServerRoot &quot;${SRVROOT}&quot;
</code></pre><ol>
<li>80端口和443端口冲突。解决方案：打开conf/extra/httpd-ssl或者…/httpd-ahssl文件将Listen端口号更改为其他。这里改为8180和442</li>
</ol>
<h2 id="卸载Httpd"><a href="#卸载Httpd" class="headerlink" title="卸载Httpd"></a>卸载Httpd</h2><pre><code>httpd -k uninstall
</code></pre><h2 id="重新安装。运行不报错"><a href="#重新安装。运行不报错" class="headerlink" title="重新安装。运行不报错"></a>重新安装。运行不报错</h2><pre><code>httpd -k install
</code></pre><h2 id="启动Apache"><a href="#启动Apache" class="headerlink" title="启动Apache"></a>启动Apache</h2><pre><code>httpd -k start
</code></pre><h2 id="访问http-localhost-8180"><a href="#访问http-localhost-8180" class="headerlink" title="访问http://localhost:8180"></a>访问<a href="http://localhost:8180" target="_blank" rel="external">http://localhost:8180</a></h2><h2 id="向apcache添加php依赖-httpd-conf"><a href="#向apcache添加php依赖-httpd-conf" class="headerlink" title="向apcache添加php依赖(httpd.conf)"></a>向apcache添加php依赖(httpd.conf)</h2><pre><code> # 如下为PHP环境添加模块
LoadModule php5_module &quot;G:/php/php56/php5apache2_4.dll&quot;
PHPIniDir &quot;G:/php/php56/php.ini&quot; # php.ini-production重命名

# 添加PHP支持
AddType application/x-httpd-php .php
</code></pre>   <ifmodule dir_module=""><br>        DirectoryIndex index.html index.htm index.php<br>    </ifmodule>

</li>
</ol>
<h2 id="修改php-ini"><a href="#修改php-ini" class="headerlink" title="修改php.ini"></a>修改php.ini</h2><pre><code>doc_root = G:\php\httpd\Apache24\htdocs
</code></pre><h2 id="全局搜索"><a href="#全局搜索" class="headerlink" title="全局搜索"></a>全局搜索</h2><pre><code>; extension_dir = &quot;./&quot;
</code></pre><h2 id="添加"><a href="#添加" class="headerlink" title="添加"></a>添加</h2><pre><code>extension_dir = &quot;G:\php\php56\ext&quot;
</code></pre><h2 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h2><pre><code>;extension=php_bz2.dll
extension=php_curl.dll
;extension=php_fileinfo.dll
extension=php_gd2.dll
;extension=php_gettext.dll
;extension=php_gmp.dll
;extension=php_intl.dll
extension=php_imap.dll
;extension=php_interbase.dll
;extension=php_ldap.dll
extension=php_mbstring.dll
;extension=php_exif.dll      ; Must be after mbstring as it depends on it
extension=php_mysql.dll
extension=php_mysqli.dll
;extension=php_oci8_12c.dll  ; Use with Oracle Database 12c Instant Client
;extension=php_openssl.dll
;extension=php_pdo_firebird.dll
extension=php_pdo_mysql.dll
;extension=php_pdo_oci.dll
;extension=php_pdo_odbc.dll
;extension=php_pdo_pgsql.dll
;extension=php_pdo_sqlite.dll
;extension=php_pgsql.dll
;extension=php_shmop.dll

; The MIBS data available in the PHP distribution must be installed. 
; See http://www.php.net/manual/en/snmp.installation.php 
extension=php_snmp.dll

extension=php_soap.dll
extension=php_sockets.dll
;extension=php_sqlite3.dll
;extension=php_sybase_ct.dll
;extension=php_tidy.dll
;extension=php_xmlrpc.dll
;extension=php_xsl.dll
</code></pre><h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>${apachePath}/htdocs 新建phpinfo.php，添加内容</p>
<pre><code>&lt;?php phpinfo();?&gt;
</code></pre><h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a href="https://segmentfault.com/a/1190000003409708" target="_blank" rel="external">https://segmentfault.com/a/1190000003409708</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/07/07/hive学习笔记-一-——-基础入门/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dzx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx2.sinaimg.cn/mw690/63b4ac8dgy1ffzs5lll1oj20zk0qoq4z.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dzxblog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/07/07/hive学习笔记-一-——-基础入门/" itemprop="url">hive学习笔记(一) —— 基础入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-07T15:26:13+08:00">
                2017-07-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Hive学习笔记（一）"><a href="#Hive学习笔记（一）" class="headerlink" title="Hive学习笔记（一）"></a>Hive学习笔记（一）</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><blockquote>
<p>Hive是一个基于Apache Hadoop的数据仓库。对于数据存储与处理，Hadoop提供了主要的扩展和容错能力。</p>
</blockquote>
<p>对于大量的数据，使得数据汇总，查询和分析更加简单。它提供了SQL，允许用户更加简单地进行查询，汇总和数据分析。</p>
<p>同时，Hive的SQL给予了用户多种方式来集成自己的功能，然后做定制化的查询，例如用户自定义函数</p>
<h2 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h2><ul>
<li>数据库<ul>
<li>相当于命名空间，避免表，视图，分区，列等等的命名冲突</li>
</ul>
</li>
<li>表<ul>
<li>相同数据库的同类数据单元</li>
</ul>
</li>
<li>分区<ul>
<li>每个表可以有一个或多个用于决定数据如何存储的分区键</li>
</ul>
</li>
<li>桶<ul>
<li>每个分区的数据，基于表的一些列的哈希函数值，又被分割成桶</li>
</ul>
</li>
</ul>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><ul>
<li>Integer<ul>
<li>tinyint、smallint、int、bigint</li>
</ul>
</li>
<li>布尔<ul>
<li>boolean</li>
</ul>
</li>
<li>浮点数<ul>
<li>float</li>
<li>double</li>
</ul>
</li>
<li>定点数<ul>
<li>decimal</li>
</ul>
</li>
<li>字符串<ul>
<li>string</li>
<li>varchar</li>
<li>char</li>
</ul>
</li>
<li>日期和时间<ul>
<li>timestemp</li>
<li>date</li>
</ul>
</li>
<li>二进制<ul>
<li>binary</li>
</ul>
</li>
<li>复杂类型<ul>
<li>结构体类型(Stuct)<ul>
<li>列a{b int,c,int},通过列.属性访问(例如：a.b,a.c）</li>
</ul>
</li>
<li>Map键值对类型<ul>
<li>通过[‘colName’]访问</li>
</ul>
</li>
<li>数组<ul>
<li>通过[‘n’]访问数组</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="内置运算和函数"><a href="#内置运算和函数" class="headerlink" title="内置运算和函数"></a>内置运算和函数</h2><p><a href="https://strongyoung.gitbooks.io/hive/content/built-in-operators-and-functions.html" target="_blank" rel="external">参考文档</a></p>
<ul>
<li>关系运算</li>
<li>数学运算</li>
<li>逻辑运算</li>
<li>复杂类型运算</li>
</ul>
<h2 id="提供基本SQL"><a href="#提供基本SQL" class="headerlink" title="提供基本SQL"></a>提供基本SQL</h2><ul>
<li>where筛选条件</li>
<li>select查询指定列</li>
<li>2表join查询</li>
<li>多个group by列上使用聚合</li>
<li>可以存储擦讯结构到另一个表</li>
<li>可以下载表内容到本地</li>
<li>可以存储查询结果到hadoop分布式文件系统目录</li>
<li>可以管理表和分区</li>
<li>可以使用自定义脚本</li>
</ul>
<h2 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h2><ul>
<li>PARTITIONED：指定分区列</li>
</ul>
<pre><code>CREATE TABLE page_view(viewTime INT, userid BIGINT,
        page_url STRING, referrer_url STRING,
        ip STRING COMMENT &apos;IP Address of the User&apos;)
COMMENT &apos;This is the page view table&apos;
PARTITIONED BY(dt STRING, country STRING)
STORED AS SEQUENCEFILE;
</code></pre><ul>
<li>指定分隔符</li>
</ul>
<pre><code>CREATE TABLE page_view(viewTime INT, userid BIGINT,
        page_url STRING, referrer_url STRING,
        ip STRING COMMENT &apos;IP Address of the User&apos;)
COMMENT &apos;This is the page view table&apos;
PARTITIONED BY(dt STRING, country STRING)
ROW FORMAT DELIMITED
        FIELDS TERMINATED BY &apos;1&apos;
STORED AS SEQUENCEFILE;
</code></pre><ul>
<li><p>分桶</p>
<pre><code>CREATE TABLE page_view(viewTime INT, userid BIGINT,
        page_url STRING, referrer_url STRING,
        ip STRING COMMENT &apos;IP Address of the User&apos;)
COMMENT &apos;This is the page view table&apos;
PARTITIONED BY(dt STRING, country STRING)
CLUSTERED BY(userid) SORTED BY(viewTime) INTO 32 BUCKETS
ROW FORMAT DELIMITED
        FIELDS TERMINATED BY &apos;1&apos;
        COLLECTION ITEMS TERMINATED BY &apos;2&apos;
        MAP KEYS TERMINATED BY &apos;3&apos;
STORED AS SEQUENCEFILE;
</code></pre></li>
</ul>
<h3 id="浏览表分区"><a href="#浏览表分区" class="headerlink" title="浏览表分区"></a>浏览表分区</h3><pre><code>show tables
</code></pre><h3 id="列出数据库里所有表"><a href="#列出数据库里所有表" class="headerlink" title="列出数据库里所有表"></a>列出数据库里所有表</h3><p><strong>遵循Java正则表达式</strong><br>        show tables ‘page.*’;</p>
<h3 id="列出表的分区"><a href="#列出表的分区" class="headerlink" title="列出表的分区"></a>列出表的分区</h3><pre><code>describe page_view;
</code></pre><h3 id="列出表列和类型"><a href="#列出表列和类型" class="headerlink" title="列出表列和类型"></a>列出表列和类型</h3><pre><code>describe extended page_view;
</code></pre><h3 id="列出表列和其他属性（通常用作调试"><a href="#列出表列和其他属性（通常用作调试" class="headerlink" title="列出表列和其他属性（通常用作调试)"></a>列出表列和其他属性（通常用作调试)</h3><pre><code>DESCRIBE EXTENDED page_view PARTITION (ds=&apos;2016-08-08&apos;);
</code></pre><h3 id="修改表"><a href="#修改表" class="headerlink" title="修改表"></a>修改表</h3><pre><code>ALTER TABLE old_table_name RENAME TO new_table_name;
</code></pre><h3 id="增加列"><a href="#增加列" class="headerlink" title="增加列"></a>增加列</h3><pre><code>ALTER TABLE tab1 ADD COLUMNS (c1 INT COMMENT &apos;a new int column&apos;, c2 STRING DEFAULT &apos;def val&apos;);
</code></pre><h3 id="删除表和分区"><a href="#删除表和分区" class="headerlink" title="删除表和分区"></a>删除表和分区</h3><pre><code>DROP TABLE pv_users;
ALTER TABLE pv_users DROP PARTITION (ds=&apos;2016-08-08&apos;)
</code></pre><h2 id="加载数据"><a href="#加载数据" class="headerlink" title="加载数据"></a>加载数据</h2><blockquote>
<p>用户可以创建一个“外部表”来指向一个特定的HDFS路径。用这种方法，用户可以使用HDFSput或copy命令，复制一个文件到指定的位置，并且附上相应的行格式信息创建一个表指定这个位置</p>
</blockquote>
<p>例如，如果文件/tmp/pv_2016-06-08.txt包含逗号分隔的页面访问记录。这需要以合适的分区加载到表page_view</p>
<pre><code>CREATE EXTERNAL TABLE page_view_stg(viewTime INT, userid BIGINT,
        page_url STRING, referrer_url STRING,
        ip STRING COMMENT &apos;IP Address of the User&apos;,
        country STRING COMMENT &apos;country of origination&apos;)
COMMENT &apos;This is the staging page view table&apos;
ROW FORMAT DELIMITED FIELDS TERMINATED BY &apos;44&apos; LINES TERMINATED BY &apos;12&apos;
STORED AS TEXTFILE
LOCATION &apos;/user/data/staging/page_view&apos;;

hadoop dfs -put /tmp/pv_2016-06-08.txt /user/data/staging/page_view

FROM page_view_stg pvs
INSERT OVERWRITE TABLE page_view PARTITION(dt=&apos;2016-06-08&apos;, country=&apos;US&apos;)
SELECT pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, null, null, pvs.ip
WHERE pvs.country = &apos;US&apos;;
</code></pre><h3 id="本地文件系统加载"><a href="#本地文件系统加载" class="headerlink" title="本地文件系统加载"></a>本地文件系统加载</h3><pre><code>LOAD DATA LOCAL INPATH /tmp/pv_2016-06-08_us.txt INTO TABLE page_view PARTITION(date=&apos;2016-06-08&apos;, country=&apos;US&apos;)
</code></pre><h3 id="简单的查询"><a href="#简单的查询" class="headerlink" title="简单的查询"></a>简单的查询</h3><pre><code>INSERT OVERWRITE TABLE user_active
SELECT user.*
FROM user
WHERE user.active = 1;

SELECT user.*
FROM user
WHERE user.active = 1;
</code></pre><h3 id="基于查询分区"><a href="#基于查询分区" class="headerlink" title="基于查询分区"></a>基于查询分区</h3><pre><code>INSERT OVERWRITE TABLE xyz_com_page_views
SELECT page_views.*
FROM page_views
WHERE page_views.date &gt;= &apos;2008-03-01&apos; AND page_views.date &lt;= &apos;2008-03-31&apos; AND
      page_views.referrer_url like &apos;%xyz.com&apos;;
</code></pre><h3 id="联结查询"><a href="#联结查询" class="headerlink" title="联结查询"></a>联结查询</h3><p><strong>LEFT OUTER,RIGHT OUTER或FULL OUTER</strong><br>        INSERT OVERWRITE TABLE pv_users<br>        SELECT pv.*, u.gender, u.age<br>        FROM user u JOIN page_view pv ON (pv.userid = u.id)<br>        WHERE pv.date = ‘2008-03-03’;</p>
<h3 id="为了检查key在另外一个表中是否存在，用户可以使用LEFT-SEMI-JOIN"><a href="#为了检查key在另外一个表中是否存在，用户可以使用LEFT-SEMI-JOIN" class="headerlink" title="为了检查key在另外一个表中是否存在，用户可以使用LEFT SEMI JOIN"></a>为了检查key在另外一个表中是否存在，用户可以使用LEFT SEMI JOIN</h3><pre><code>INSERT OVERWRITE TABLE pv_users
SELECT u.*
FROM user u LEFT SEMI JOIN page_view pv ON (pv.userid = u.id)
WHERE pv.date = &apos;2008-03-03&apos;;
</code></pre><h3 id="多表联结"><a href="#多表联结" class="headerlink" title="多表联结"></a>多表联结</h3><pre><code>INSERT OVERWRITE TABLE pv_friends
SELECT pv.*, u.gender, u.age, f.friends
FROM page_view pv JOIN user u ON (pv.userid = u.id) JOIN friend_list f ON (u.id = f.uid)
WHERE pv.date = &apos;2008-03-03&apos;;
</code></pre><h3 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h3><pre><code>INSERT OVERWRITE TABLE pv_gender_sum
SELECT pv_users.gender, count (DISTINCT pv_users.userid)
FROM pv_users
GROUP BY pv_users.gender;
</code></pre><h3 id="两个聚合函数不能同时用DISTINCT作用于不同的列，以下情况是可以的（DISTINCT作用于相同列）"><a href="#两个聚合函数不能同时用DISTINCT作用于不同的列，以下情况是可以的（DISTINCT作用于相同列）" class="headerlink" title="两个聚合函数不能同时用DISTINCT作用于不同的列，以下情况是可以的（DISTINCT作用于相同列）"></a>两个聚合函数不能同时用DISTINCT作用于不同的列，以下情况是可以的（DISTINCT作用于相同列）</h3><pre><code>INSERT OVERWRITE TABLE pv_gender_agg
SELECT pv_users.gender, count(DISTINCT pv_users.userid), count(*), sum(DISTINCT pv_users.userid)
FROM pv_users
GROUP BY pv_users.gender;
</code></pre><h3 id="多表文件插入"><a href="#多表文件插入" class="headerlink" title="多表文件插入"></a>多表文件插入</h3><p>第一个插入语句将结果插入到Hive表中，而第二个插入语句是将结果写到HDFS文件。<br>        FROM pv_users<br>        INSERT OVERWRITE TABLE pv_gender_sum<br>            SELECT pv_users.gender, count_distinct(pv_users.userid)<br>            GROUP BY pv_users.gender</p>
<pre><code>INSERT OVERWRITE DIRECTORY &apos;/user/data/tmp/pv_age_sum&apos;
    SELECT pv_users.age, count_distinct(pv_users.userid)
    GROUP BY pv_users.age;
</code></pre><h3 id="动态分区插入"><a href="#动态分区插入" class="headerlink" title="动态分区插入"></a>动态分区插入</h3><pre><code>FROM page_view_stg pvs
INSERT OVERWRITE TABLE page_view PARTITION(dt=&apos;2008-06-08&apos;, country=&apos;US&apos;)
       SELECT pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, null, null, pvs.ip WHERE pvs.country = &apos;US&apos;
INSERT OVERWRITE TABLE page_view PARTITION(dt=&apos;2008-06-08&apos;, country=&apos;CA&apos;)
       SELECT pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, null, null, pvs.ip WHERE pvs.country = &apos;CA&apos;
INSERT OVERWRITE TABLE page_view PARTITION(dt=&apos;2008-06-08&apos;, country=&apos;UK&apos;)
       SELECT pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, null, null, pvs.ip WHERE pvs.country = &apos;UK&apos;;
</code></pre><h3 id="插入到本地文件"><a href="#插入到本地文件" class="headerlink" title="插入到本地文件"></a>插入到本地文件</h3><pre><code>INSERT OVERWRITE LOCAL DIRECTORY &apos;/tmp/pv_gender_sum&apos;
SELECT pv_gender_sum.*
FROM pv_gender_sum;
</code></pre><h3 id="抽样"><a href="#抽样" class="headerlink" title="抽样"></a>抽样</h3><p>抽样语句允许用户对数据抽样查询，而不是全表查询。<br>抽样是对那些在CREATE TABLE语句的CLUSTERED BY修饰的列上。</p>
<pre><code>INSERT OVERWRITE TABLE pv_gender_sum_sample
SELECT pv_gender_sum.*
FROM pv_gender_sum TABLESAMPLE(BUCKET 3 OUT OF 32);
</code></pre><h3 id="union-all"><a href="#union-all" class="headerlink" title="union all"></a>union all</h3><pre><code>INSERT OVERWRITE TABLE actions_users
SELECT u.id, actions.date
FROM (
    SELECT av.uid AS uid
    FROM action_video av
    WHERE av.date = &apos;2008-06-03&apos;

    UNION ALL

    SELECT ac.uid AS uid
    FROM action_comment ac
    WHERE ac.date = &apos;2008-06-03&apos;
    ) actions JOIN users u ON(u.id = actions.uid);
</code></pre><h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><pre><code>CREATE TABLE array_table (int_array_column ARRAY&lt;INT&gt;);

SELECT pv.friends[2]
FROM page_views pv;

SELECT pv.userid, size(pv.friends)
FROM page_view pv;
</code></pre><h3 id="Map（关联数组）"><a href="#Map（关联数组）" class="headerlink" title="Map（关联数组）"></a>Map（关联数组）</h3><pre><code>INSERT OVERWRITE page_views_map
SELECT pv.userid, pv.properties[&apos;page type&apos;]
FROM page_views pv;

SELECT size(pv.properties)
FROM page_view pv;
</code></pre><h3 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a><a href="https://strongyoung.gitbooks.io/hive/content/" target="_blank" rel="external">参考文档</a></h3>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://wx2.sinaimg.cn/mw690/63b4ac8dgy1ffzs5lll1oj20zk0qoq4z.jpg"
               alt="dzx" />
          <p class="site-author-name" itemprop="name">dzx</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">142</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">57</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">108</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">dzx</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

  

</body>
</html>
