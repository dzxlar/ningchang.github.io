<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="dzxblog">
<meta property="og:url" content="http://yoursite.com/page/12/index.html">
<meta property="og:site_name" content="dzxblog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="dzxblog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/12/"/>





  <title>dzxblog</title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  















  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">dzxblog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/05/深入理解JVM学习笔记（三）-——-GC收集器和内存分配/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dzx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx2.sinaimg.cn/mw690/63b4ac8dgy1ffzs5lll1oj20zk0qoq4z.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dzxblog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/05/深入理解JVM学习笔记（三）-——-GC收集器和内存分配/" itemprop="url">深入理解JVM学习笔记（三） —— GC收集器和内存分配</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-05T10:32:08+08:00">
                2017-06-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JVM/" itemprop="url" rel="index">
                    <span itemprop="name">JVM</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="判断对象是否存活"><a href="#判断对象是否存活" class="headerlink" title="判断对象是否存活"></a>判断对象是否存活</h2><h3 id="引用计数算法"><a href="#引用计数算法" class="headerlink" title="引用计数算法"></a>引用计数算法</h3><blockquote>
<p>很多判断对象是否存活的方式就是引用计数算法：给对象添加一个引用计数器，每当一个地方引用它，计数器+1；引用失效，计数器-1。</p>
</blockquote>
<hr>
<blockquote>
<p><strong>任何时刻计数器为0的对象是不可能再被使用的。</strong></p>
</blockquote>
<hr>
<blockquote>
<p><strong>Java虚拟机没有使用主流的引用计数法管理内存。主要原因是难以解决对象之间相互循环引用的问题</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">classA.instance = classB</div><div class="line">classB.instance = classA</div></pre></td></tr></table></figure>
<p>classA和classB已经不可能再被访问，但是classA和classB互相引用对方，导致计数器永远不可能是0，导致GC无法回收两个对象</p>
<hr>
<h2 id="可达性分析算法"><a href="#可达性分析算法" class="headerlink" title="可达性分析算法"></a>可达性分析算法</h2><blockquote>
<p>通过一系列称为”GC Roots”对象作为起始点，从这些节点向下搜索，搜索过的路径称为引用链。</p>
</blockquote>
<hr>
<blockquote>
<p><strong>当一个对象的GCRoots没有任何引用链相连时，则证明该对象不可用。</strong></p>
</blockquote>
<p>在java中可作为GCRoots对象的是</p>
<ol>
<li>虚拟机栈（栈帧本地变量表）引用的对象</li>
<li>方法区中类属性引用对象</li>
<li>方法区中常量引用对象</li>
<li>本地方法栈（JNI）中引用对象</li>
</ol>
<hr>
<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><p>Java引用分类(又上到下引用关系依次减弱)</p>
<ul>
<li>强引用<ul>
<li>必须存在的对象</li>
<li>类似ObjectA objA = new ObjectA()</li>
</ul>
</li>
<li>软引用<ul>
<li>有用但非必须的对象</li>
<li>在发生内存溢出后，可进行二次回收</li>
</ul>
</li>
<li>弱引用<ul>
<li>非必须对象</li>
<li>无论当前内存是否足够，都会回收掉只被弱关联对象</li>
</ul>
</li>
<li>虚引用<ul>
<li>是否存在不会对生存时间对其影响</li>
</ul>
</li>
</ul>
<hr>
<h2 id="生存或者死亡"><a href="#生存或者死亡" class="headerlink" title="生存或者死亡"></a>生存或者死亡</h2><blockquote>
<p>判断一个对象死亡，<strong>至少经历两次标志过程</strong>：如果对象进行可达性分析，<strong>GCRoot没有相连的引用链，那么被第一次标记进行筛选</strong>；<strong>筛选的条件是是否有必要进行finalize()方法</strong>；对象没有覆盖finalize()方法或者已经被虚拟机调用过finalize()方法，则该对象没必要销毁；<strong>如果这个对象有必要执行finalize()方法，会将它放置在F-Queue队列中</strong>，并在稍后由一个虚拟机自动执行、低优先级的Finalizer线程去执行；<strong>GC稍后会对F-Queue中的对象进行二次标记</strong></p>
</blockquote>
<hr>
<blockquote>
<p>如果对象需要拯救自己不被回收。只要重新与引用链的任何一个对象重新关联为止（例如.this)</p>
</blockquote>
<hr>
<blockquote>
<p>注意：自救的机会只能使用一次；一个对象的finalize方法最多只被系统调用一次</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">private static FinallyProperty escapeGC = null;</div><div class="line"></div><div class="line">@Override</div><div class="line">void finalize() throws Throwable&#123;</div><div class="line">   super.finalize();</div><div class="line">   FinallyProperty.escapeGC = this;   </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h2 id="回收方法区"><a href="#回收方法区" class="headerlink" title="回收方法区"></a>回收方法区</h2><blockquote>
<p>永久代的垃圾回收主要是2个部分:废弃变量和无用的类</p>
</blockquote>
<ul>
<li>废弃变量：与Java堆中的回收类似；例如.没有任何一个地方引用常量池的”abc”字面量，这时发生了内存回收；这个”abc”会被清理出常量池</li>
<li>无用的类需要满足的3个条件<ul>
<li>java堆中不存在该类的任何实例</li>
<li>加载该类的ClassLoader已被回收</li>
<li>无法在任何地方通过反射访问该类的方法</li>
</ul>
</li>
</ul>
<hr>
<h2 id="垃圾收集算法"><a href="#垃圾收集算法" class="headerlink" title="垃圾收集算法"></a>垃圾收集算法</h2><h3 id="标记-清除"><a href="#标记-清除" class="headerlink" title="标记-清除"></a>标记-清除</h3><blockquote>
<p>在回收之前，首先标志出需要回收的对象，在标志完成后统一回收所有标志对象<br>后面的算法都是基于”标记-清除”算法的改进</p>
</blockquote>
<p>该算法的主要缺点</p>
<ol>
<li>效率低下：产生过多内存碎片</li>
<li>空间占用过多</li>
</ol>
<h3 id="复制算法"><a href="#复制算法" class="headerlink" title="复制算法"></a>复制算法</h3><blockquote>
<p>解决”标记-清除”算法效率问题</p>
</blockquote>
<hr>
<blockquote>
<p>将内存划分为容量相等的2个部分，每次只使用其中一块。当这块内存使用完毕，将还存活的对象复制在另一块上面。然后把已使用的空间一次性清理掉。</p>
</blockquote>
<hr>
<blockquote>
<p>每次对整个半区进行回收，而不讨论内存碎片等复杂情况，只需移动堆顶指针、按顺序分配内存即可。</p>
</blockquote>
<h3 id="标志-整理算法"><a href="#标志-整理算法" class="headerlink" title="标志-整理算法"></a>标志-整理算法</h3><blockquote>
<p>复制收集算法在对象存活率过高时进行复制操作，影响效率。</p>
</blockquote>
<hr>
<blockquote>
<p>根据老年代特点，提出了标志-整理算法；标志过程和标志-清除的过程一样。整理：让所有存活对象向一端移动，然后直接清理掉边界以外的内存</p>
</blockquote>
<h3 id="分代收集算法"><a href="#分代收集算法" class="headerlink" title="分代收集算法"></a>分代收集算法</h3><blockquote>
<p>一般把Java划分成新生代和老年代；根据各个年代的特点采用合适的收集算法<br>通常新生代采取：复制算法<br>老年代采取：标志-整理或者标志-清除算法</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/05/深入理解JVM学习笔记（二）-——-对象/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dzx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx2.sinaimg.cn/mw690/63b4ac8dgy1ffzs5lll1oj20zk0qoq4z.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dzxblog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/05/深入理解JVM学习笔记（二）-——-对象/" itemprop="url">深入理解JVM学习笔记（二） —— 对象</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-05T10:29:38+08:00">
                2017-06-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JVM/" itemprop="url" rel="index">
                    <span itemprop="name">JVM</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>【问题一】程序通过new一个普通对象的时候，虚拟机进行了哪些操作？<br>  解答： ①首先检查这个指令的参数是否能在常量池中定位到这个类引用<br>  ②并且检查这个符号引用代表的类是否被加载、解析、初始化过③若没有加载，必须执行相应类的类加载过程④<strong>虚拟机为新生对象分配内存</strong>(对象所需内存大小，在类加载时间可以完全确定)</p>
<h3 id="④-分配内存"><a href="#④-分配内存" class="headerlink" title="④ 分配内存"></a>④ 分配内存</h3><blockquote>
<p>为对象分配大小相当于把一块确定大小的内存从Java堆中划分出来。<strong>假设Java内存是规整的</strong>，所有用过的内存放在一边，所有空闲的内存放在一边，中间放着一个指针作为分界点的指示器。对象大小就是指针向空闲内存移动的距离，这种分配方式叫做<strong>指针碰撞</strong>。假设内存是不规整的，已使用的空间和空闲空间相互交错，虚拟机须维护一个列表，存放可用内存空间，在分配的时候根据列表找到一块足够大的空间给对象，并更新列表上的记录，这种分配被称为“空闲列表”<br>总结：选择哪种分配方式是通过Java内存是否规整决定，而Java是否规整又由采集的垃圾收集器（GC）是否带有压缩整理功能决定</p>
<p><strong>Compact收集器采用指针碰撞方式，而Mark-Slweep采用空闲列表</strong></p>
</blockquote>
<hr>
<p>分配对象可能是线程不安全的，虚拟机采用2种方式保证更新操作的原子性</p>
<ul>
<li>CAS+失败重试方式</li>
<li>每个线程预分配一小块内存(本地线程分配缓冲区TLAB)。哪个线程需要分配内存，就在哪个线程的TLAB上分配，只有TLAB用完并分配新的TLAB，才同步锁定</li>
</ul>
<p>使用TLAB<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-XX:+/-UseTLAB</div></pre></td></tr></table></figure></p>
<h3 id="⑤-初始化"><a href="#⑤-初始化" class="headerlink" title="⑤ 初始化"></a>⑤ 初始化</h3><blockquote>
<p>虚拟机将分配到的内存空间初始化为0.如果使用TLAB，可将这一操作提前到分配TLAB时进行。<br>保证Java实例对象字段，不需要初始化，就可以直接使用。</p>
</blockquote>
<p>###⑥ 必要设置</p>
<blockquote>
<p>虚拟机对对象进行必要的设置。例如: 对象属于哪个类实例、如何找到类的元数据信息、对象哈希码、对象GC分代年龄等设置</p>
</blockquote>
<p>以上完成后。对于虚拟机来说，一个对象已经产生了，但是从Java的角度看，一个对象的创建刚刚开始——init()还未执行，所有字段还是0.</p>
<blockquote>
<p>注意：<strong>当一个对象初始化之后，一个真正可用的对象才算生成。</strong></p>
</blockquote>
<hr>
<h2 id="对象的内存布局"><a href="#对象的内存布局" class="headerlink" title="对象的内存布局"></a>对象的内存布局</h2><p>对象在内存中的布局包含：<strong>对象头、实例数据、对齐填充</strong><br>HotSpot虚拟机对象头包括：<strong>存储自身对象运行数据和类型指针</strong></p>
<ul>
<li>存储自身对象<ul>
<li>哈希码、GC分代年龄、锁标志、线程持有锁、偏向线程ID、偏向时间戳等</li>
</ul>
</li>
<li>类型指针<ul>
<li>通过这个指针确定这个对象属于哪个类实例。但是不是所有虚拟机都必须在对象数据类型保留类型指针，所以查找对象的元数据信息不一定要经过类本身。如果是一个数组，还需要记录长度数据。</li>
</ul>
</li>
</ul>
<hr>
<p>实例数据字段分配策略顺序：longs/doubles -&gt; int -&gt; short/chars -&gt; byte/boolean -&gt; oops </p>
<ol>
<li>相同宽度的字段总是分配在一起</li>
<li>父类定义的变量总是在子类之前</li>
<li>对其填充仅仅起占位符的作用</li>
</ol>
<hr>
<h2 id="对象访问定位"><a href="#对象访问定位" class="headerlink" title="对象访问定位"></a>对象访问定位</h2><blockquote>
<p>通过栈上的reference数据操作堆上数据<br>reference只提供了一个指向对象的引用，访问定位主流方式有使用句柄和直接指针两种方式实现</p>
</blockquote>
<p>访问方式</p>
<ul>
<li><p>使用句柄</p>
<ul>
<li>Java堆划分一块内存作为句柄池，reference存储对象句柄地址。而句柄中包含对象实例数据和类型数据各自的地址信息</li>
</ul>
</li>
<li><p>使用直接指针</p>
<ul>
<li>reference存储的是对象地址</li>
</ul>
</li>
</ul>
<p>句柄访问方式<br><img src="http://img.blog.csdn.net/20170414155500400?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjA1OTc0Nzk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="句柄访问方式"></p>
<p>直接指针访问方式<br><img src="http://img.blog.csdn.net/20170414155520041?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjA1OTc0Nzk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="直接指针访问方式"></p>
<p>句柄访问优点：在对象移动时，改变的只是句柄中的实例数据本身，而reference本身并不改变</p>
<p>直接指针的优点：访问速度快，节省了指针定位的开销</p>
<ul>
<li></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/05/深入理解JVM学习笔记（一）-——-JVM数据区域/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dzx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx2.sinaimg.cn/mw690/63b4ac8dgy1ffzs5lll1oj20zk0qoq4z.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dzxblog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/05/深入理解JVM学习笔记（一）-——-JVM数据区域/" itemprop="url">深入理解JVM学习笔记（一） —— JVM数据区域</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-05T10:28:56+08:00">
                2017-06-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/JVM/" itemprop="url" rel="index">
                    <span itemprop="name">JVM</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="JVM结构图"><a href="#JVM结构图" class="headerlink" title="JVM结构图"></a>JVM结构图</h3><p><img src="http://img.blog.csdn.net/20170413114755159?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjA1OTc0Nzk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="JVM结构"></p>
<h2 id="程序计数器"><a href="#程序计数器" class="headerlink" title="程序计数器"></a>程序计数器</h2><blockquote>
<p>是一块较小的内存空间。当前线程所执行的字节码的行号指示器。</p>
</blockquote>
<p>字节码解释器工作原理</p>
<blockquote>
<p>通过改变计数器的值来选取下一条需要执行的字节码指令。</p>
</blockquote>
<p>分支、循环、跳转、异常处理、线程恢复等操作都需要依赖计数器</p>
<p>JAVA多线程实现方式</p>
<blockquote>
<p>线程之间轮流切换并分配处理器执行时间实现的</p>
</blockquote>
<p>运行Java方法时，执行虚拟机字节码指令地址。<br>运行Native方法时，计数器则为空(undefined)。<strong>是唯一一个在java虚拟机中没有规定outOfMemoryError的错误</strong></p>
<hr>
<h2 id="虚拟机栈"><a href="#虚拟机栈" class="headerlink" title="虚拟机栈"></a>虚拟机栈</h2><blockquote>
<p>线程私有。虚拟机栈的生命周期和线程相同。用来描述java方法执行的内存模型。</p>
</blockquote>
<h3 id="栈帧"><a href="#栈帧" class="headerlink" title="栈帧"></a>栈帧</h3><blockquote>
<p>每个方法创建时产生</p>
<p>作用：存储局部变量表、操作数栈、动态链接、方法出口等。</p>
<p><strong>每个方法调用到执行完成的过程，对应一个虚拟机栈帧入栈到出栈的过程</strong></p>
</blockquote>
<p>堆(Heap)栈(Stack)只是java虚拟机内存粗略的划分</p>
<p>局部变量存储了编译时期各种基本类型、对象引用。不等于对象本身，可能是指向对象起始地址的引用指针，也可能是代表一个对象的句柄或其他与此对象相关的位置和returnAddress(字节码地址)</p>
<p>特例：64位长度的long和double类型数据占用2个局部变量空间。其余只占用1个。</p>
<h2 id="虚拟机栈异常"><a href="#虚拟机栈异常" class="headerlink" title="虚拟机栈异常"></a>虚拟机栈异常</h2><ol>
<li><strong>线程请求的栈深度大于虚拟机所允许的栈深度，抛出StackOverException</strong></li>
<li><strong>虚拟机动态扩展到无法申请到更多可用内存，抛出OutOfMemoryException</strong></li>
</ol>
<hr>
<h2 id="本地方法栈"><a href="#本地方法栈" class="headerlink" title="本地方法栈"></a>本地方法栈</h2><blockquote>
<p>虚拟机栈有的特性，本地方法栈都有。唯一的区别：<strong>虚拟机栈执行Java方法，本地方法栈执行Native方法</strong></p>
</blockquote>
<hr>
<h2 id="堆（Heap）"><a href="#堆（Heap）" class="headerlink" title="堆（Heap）"></a>堆（Heap）</h2><blockquote>
<p>虚拟机管理内存中最大的一块。<br>被所有线程共享的内存区域。<br>唯一作用就是存放对象实例。</p>
</blockquote>
<p>不过随着JIT编译器发展与逃逸分析技术成熟，栈上分配、标量替换也可以存放对象实例。</p>
<p>Java堆是垃圾收集管理的主要区域，也叫做GC堆。</p>
<p>从内存回收的角度看。由于垃圾回收分析采用分代收集算法。可细分为：新生代和老年代。也可分为：<strong>Eden空间、From Survivor空间、To Survivor空间。</strong></p>
<p>从内存分配的角度看。线程共享的Java堆可划分<strong>多个线程私有的线程缓冲区。</strong></p>
<p><strong>划分的目的是为了更好的回收内存、更快的分配内存。</strong></p>
<p>-Xms 和 Xmx 控制Java堆大小。</p>
<p><strong>堆异常</strong><br>如果堆中内存没有完成实例分配，抛出OutOfMemoryException</p>
<hr>
<h2 id="方法区"><a href="#方法区" class="headerlink" title="方法区"></a>方法区</h2><blockquote>
<p>各个线程的共享区域。存储<strong>已加载的类信息、常量、静态变量以及编译器编译后的代码数据。</strong><br>为了与Java堆区分开，方法区的另一个别名non-Heap(非堆)</p>
</blockquote>
<p><strong>非堆可以不实现垃圾收集。</strong></p>
<h2 id="运行时常量池"><a href="#运行时常量池" class="headerlink" title="运行时常量池"></a>运行时常量池</h2><blockquote>
<p>属于方法区一部分。用于存放编译时期生成的各种字面量和符号引用。<br>运行时常量池相当于Class常量池又一重要的特性：动态性。<br>运行期可将新的常量放入常量池。常用的是String的intern() </p>
</blockquote>
<h2 id="直接内存"><a href="#直接内存" class="headerlink" title="直接内存"></a>直接内存</h2><blockquote>
<p>不属于虚拟机运行时数据区。也不属于虚拟机定义的内存区域。但是被频繁使用。可能导致OutOfMemoryException出现。</p>
</blockquote>
<p>NIO就使用了这个方式。通过使用Native函数直接分配给堆外内存。然后通过一个存储在Java堆中directByteBuffer对象作为这块内存的引用。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/05/Servlet3新特性/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dzx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx2.sinaimg.cn/mw690/63b4ac8dgy1ffzs5lll1oj20zk0qoq4z.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dzxblog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/05/Servlet3新特性/" itemprop="url">【Servlet3】新特性</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-05T10:26:32+08:00">
                2017-06-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Servlet/" itemprop="url" rel="index">
                    <span itemprop="name">Servlet</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Servlet3新增功能"><a href="#Servlet3新增功能" class="headerlink" title="Servlet3新增功能"></a>Servlet3新增功能</h2><ul>
<li>异步处理支持</li>
<li>新增的注解支持</li>
<li>可插性支持</li>
</ul>
<h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><h3 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">@WebFilter(filterName = &quot;myFilter&quot;, urlPatterns=&quot;/*&quot;,</div><div class="line">        dispatcherTypes = &#123;DispatcherType.REQUEST, DispatcherType.FORWARD&#125;)</div><div class="line">public class MyFilter implements Filter &#123;</div><div class="line">    @Override</div><div class="line">    public void init(final FilterConfig filterConfig) throws ServletException &#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void doFilter(final ServletRequest request, final ServletResponse response, final FilterChain chain) throws IOException, ServletException &#123;</div><div class="line">        chain.doFilter(request, response);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void destroy() &#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Listener"><a href="#Listener" class="headerlink" title="Listener"></a>Listener</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">@WebListener</div><div class="line">public class MyServletContextListener implements ServletContextListener &#123;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void contextInitialized(final ServletContextEvent ctx) &#123;</div><div class="line">        System.out.println(&quot;init servlet context&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void contextDestroyed(final ServletContextEvent ctx) &#123;</div><div class="line">        System.out.println(&quot;destroy servlet container&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">@WebServlet(name = &quot;myServlet&quot;,</div><div class="line">		    urlPatterns = &#123;&quot;/servlet1&quot;, &quot;/servlet1/*&quot;&#125;, </div><div class="line">		    loadOnStartup = 1,</div><div class="line">	        initParams = &#123;</div><div class="line">                @WebInitParam(name = &quot;msg&quot;, value=&quot;test&quot;)</div><div class="line">	        &#125;)</div><div class="line">public class MyServlet extends HttpServlet &#123;</div><div class="line">    private String msg;</div><div class="line"></div><div class="line">    public MyServlet() &#123;</div><div class="line">        System.out.println(&quot;load on startup&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void init() throws ServletException &#123;</div><div class="line">        super.init();</div><div class="line">        msg = this.getInitParameter(&quot;msg&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void doGet(final HttpServletRequest req, final HttpServletResponse resp) throws ServletException, IOException &#123;</div><div class="line">        System.out.println(msg);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="SpringMVC"><a href="#SpringMVC" class="headerlink" title="SpringMVC"></a>SpringMVC</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">@Configuration</div><div class="line">@ComponentScan(</div><div class="line">        value = &#123;&quot;com.test.**.service&quot;, &quot;com.test.**.dao&quot;&#125;,</div><div class="line">        excludeFilters = &#123;</div><div class="line">                @ComponentScan.Filter(type = FilterType.ANNOTATION, value = Controller.class)</div><div class="line">        &#125;)</div></pre></td></tr></table></figure>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">@Configuration</div><div class="line">@EnableWebMvc</div><div class="line">@ComponentScan(</div><div class="line">        value = &quot;com.test.**.web.controller&quot;,</div><div class="line">        includeFilters = &#123;</div><div class="line">                @ComponentScan.Filter(type = FilterType.ANNOTATION, value = Controller.class)</div><div class="line">        &#125;)</div><div class="line">public class SpringMvcConfiguration &#123;</div><div class="line"></div><div class="line">    @Bean</div><div class="line">    public ViewResolver createInternalResourceViewResolver() &#123;</div><div class="line">        InternalResourceViewResolver viewResolver = new InternalResourceViewResolver();</div><div class="line">        viewResolver.setViewClass(JstlView.class);</div><div class="line">        viewResolver.setContentType(&quot;text/html&quot;);</div><div class="line">        viewResolver.setPrefix(&quot;/WEB-INF/jsp/&quot;);</div><div class="line">        viewResolver.setSuffix(&quot;.jsp&quot;);</div><div class="line"></div><div class="line">        return viewResolver;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Bean</div><div class="line">    public DefaultServletHttpRequestHandler createDefaultServletHttpRequestHandler() &#123;</div><div class="line">        return new DefaultServletHttpRequestHandler();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h3 id="web-xml-代码配置"><a href="#web-xml-代码配置" class="headerlink" title="web.xml 代码配置"></a>web.xml 代码配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">public class NoXmlWebAppInitializer implements WebApplicationInitializer &#123;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void onStartup(final ServletContext sc) throws ServletException &#123;</div><div class="line"></div><div class="line">        //1、根上下文</div><div class="line">        AnnotationConfigWebApplicationContext  rootContext = new AnnotationConfigWebApplicationContext();</div><div class="line">        rootContext.register(RootConfiguration.class);</div><div class="line">        sc.addListener(new ContextLoaderListener(rootContext));</div><div class="line"></div><div class="line">        //2、springmvc上下文</div><div class="line">        AnnotationConfigWebApplicationContext springMvcContext = new AnnotationConfigWebApplicationContext();</div><div class="line">        springMvcContext.register(SpringMvcConfiguration.class);</div><div class="line"></div><div class="line">        //3、DispatcherServlet</div><div class="line">        DispatcherServlet dispatcherServlet = new DispatcherServlet(springMvcContext);</div><div class="line"></div><div class="line">        ServletRegistration.Dynamic dynamic = sc.addServlet(&quot;dispatcherServlet&quot;, dispatcherServlet);</div><div class="line">        dynamic.setLoadOnStartup(1);</div><div class="line">        dynamic.addMapping(&quot;/&quot;);</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="异步处理"><a href="#异步处理" class="headerlink" title="异步处理"></a>异步处理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@WebServlet(name = &quot;asyncServlet&quot;, urlPatterns = &quot;/async&quot;, asyncSupported = true)</div></pre></td></tr></table></figure>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">private final ExecutorService executorService = Executors.newScheduledThreadPool(2);</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void doGet(final HttpServletRequest req, final HttpServletResponse resp) throws ServletException, IOException &#123;</div><div class="line">        resp.setHeader(&quot;Connection&quot;, &quot;Keep-Alive&quot;);</div><div class="line">        resp.setContentType(&quot;text/html;charset=utf-8&quot;);</div><div class="line"></div><div class="line">        PrintWriter out = resp.getWriter();</div><div class="line">        out.write(&quot;hello async&quot;);</div><div class="line">        out.write(&quot;&lt;br/&gt;&quot;);</div><div class="line">        out.flush();</div><div class="line">        //1、开启异步</div><div class="line">        final AsyncContext asyncContext = req.startAsync();</div><div class="line">        //2、设置超时时间，如果不设置如jetty是30000L</div><div class="line">        asyncContext.setTimeout(10L * 1000); //设置为0表示永不超时</div><div class="line"></div><div class="line">        //把任务提交给自己的任务队列</div><div class="line">        executorService.submit(new Runnable() &#123;</div><div class="line">            @Override</div><div class="line">            public void run() &#123;</div><div class="line">                try &#123;</div><div class="line">                    Thread.sleep(3L * 1000);</div><div class="line">                    PrintWriter out = asyncContext.getResponse().getWriter();</div><div class="line">                    out.write(&quot;over&quot;);</div><div class="line">                    asyncContext.complete();</div><div class="line">                &#125; catch (Exception e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">        //4、当前线程可立即返回</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h2 id="interceptor"><a href="#interceptor" class="headerlink" title="interceptor"></a>interceptor</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">public class MyCallableInterceptor extends CallableProcessingInterceptorAdapter &#123;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public &lt;T&gt; void beforeConcurrentHandling(final NativeWebRequest request, final Callable&lt;T&gt; task) throws Exception &#123;</div><div class="line">        System.out.println(&quot;=====在startAsyc开启异步 和 提交异步任务到Executor 之前执行&quot;);</div><div class="line">        //此时可以保存一些数据到异步上下文，如spring security的SecurityContextHolder或Shiro的SecurityUtils(Subject)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public &lt;T&gt; void preProcess(final NativeWebRequest request, final Callable&lt;T&gt; task) throws Exception &#123;</div><div class="line">        //此时可以把在beforeConcurrentHandling保存的那些数据绑定到这个线程上（将在一个新线程执行）</div><div class="line">        System.out.println(&quot;在Callable.call运行之前执行&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public &lt;T&gt; void postProcess(final NativeWebRequest request, final Callable&lt;T&gt; task, final Object concurrentResult) throws Exception &#123;</div><div class="line">        System.out.println(&quot;在Callable.call运行之后执行&quot;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public &lt;T&gt; Object handleTimeout(final NativeWebRequest request, final Callable&lt;T&gt; task) throws Exception &#123;</div><div class="line">        //超时时调用，返回值将是超时后的结果</div><div class="line">        System.out.println(&quot;异步任务超时了&quot;);</div><div class="line">        return &quot;error&quot;;//返回出错时的结果，将替换掉正常时的结果</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public &lt;T&gt; void afterCompletion(final NativeWebRequest request, final Callable&lt;T&gt; task) throws Exception &#123;</div><div class="line">        //异步任务正常结束时调用</div><div class="line">        System.out.println(&quot;异步任务完成了&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">@Controller</div><div class="line">public class MyCallableController &#123;</div><div class="line"></div><div class="line">    @RequestMapping(&quot;/myCallable1&quot;)</div><div class="line">    @ResponseBody</div><div class="line">    public Callable&lt;String&gt; callable1() &#123;</div><div class="line">        return new Callable&lt;String&gt;() &#123;</div><div class="line">            @Override</div><div class="line">            public String call() throws Exception &#123;</div><div class="line">                System.out.println(&quot;====执行Callable call&quot;);</div><div class="line">                return &quot;success&quot;;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line">    @RequestMapping(&quot;/myCallable2&quot;)</div><div class="line">    @ResponseBody</div><div class="line">    public Callable&lt;String&gt; callable2() &#123;</div><div class="line">        return new Callable&lt;String&gt;() &#123;</div><div class="line">            @Override</div><div class="line">            public String call() throws Exception &#123;</div><div class="line">                Thread.sleep(31L * 1000);</div><div class="line">                System.out.println(&quot;====执行Callable call&quot;);</div><div class="line">                return &quot;success&quot;;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * spring实现方式：</div><div class="line"> *   1、把任务提交给Executor 异步执行；</div><div class="line"> *   2、执行完成后RequestMappingHandlerAdapter使用内部的  ServletInvocableHandlerMethod包装返回值，即按照非异步方式再执行</div><div class="line"> */</div><div class="line">@Controller</div><div class="line">public class CallableController &#123;</div><div class="line"></div><div class="line">    @RequestMapping(&quot;/callable1&quot;)</div><div class="line">    public Callable&lt;String&gt; callable1(final Model model) &#123;</div><div class="line">        return new Callable&lt;String&gt;() &#123;</div><div class="line">            @Override</div><div class="line">            public String call() throws Exception &#123;</div><div class="line">                Thread.sleep(2L * 1000); //暂停两秒</div><div class="line">                String viewName = &quot;msg&quot;;</div><div class="line">                model.addAttribute(&quot;msg&quot;, &quot;hello callable&quot;);</div><div class="line">                return viewName; //然后返回到指定视图页面</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @RequestMapping(&quot;/callable2&quot;)</div><div class="line">    public Callable&lt;ModelAndView&gt; callable2() &#123;</div><div class="line">        return new Callable&lt;ModelAndView&gt;() &#123;</div><div class="line">            @Override</div><div class="line">            public ModelAndView call() throws Exception &#123;</div><div class="line">                Thread.sleep(2L * 1000); //暂停两秒</div><div class="line">                ModelAndView mv = new ModelAndView(&quot;msg&quot;);</div><div class="line">                mv.addObject(&quot;msg&quot;, &quot;hello callable&quot;);</div><div class="line">                return mv;</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @RequestMapping(&quot;/callable3&quot;)</div><div class="line">    @ResponseBody</div><div class="line">    public Callable&lt;Object&gt; callable3() &#123;</div><div class="line">        return new Callable&lt;Object&gt;() &#123;</div><div class="line">            @Override</div><div class="line">            public Object call() throws Exception &#123;</div><div class="line">                Thread.sleep(2L * 1000); //暂停两秒</div><div class="line">                return new User(1, &quot;zhang&quot;);</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><a href="http://jinnianshilongnian.iteye.com/blog/1912455" target="_blank" rel="external">参考博客</a><br><a href="https://www.ibm.com/developerworks/cn/java/j-lo-servlet30/" target="_blank" rel="external">Servlet3新特性详解</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/05/Python学习笔记（二）——-正则表达式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dzx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx2.sinaimg.cn/mw690/63b4ac8dgy1ffzs5lll1oj20zk0qoq4z.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dzxblog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/05/Python学习笔记（二）——-正则表达式/" itemprop="url">Python学习笔记（二）—— 正则表达式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-05T10:23:53+08:00">
                2017-06-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="正则表达式的大致匹配过程"><a href="#正则表达式的大致匹配过程" class="headerlink" title="正则表达式的大致匹配过程"></a>正则表达式的大致匹配过程</h3><p>1.依次拿出表达式和文本中的字符比较，<br>2.如果每一个字符都能匹配，则匹配成功；一旦有匹配不成功的字符则匹配失败。<br>3.如果表达式中有量词或边界，这个过程会稍微有一些不同。</p>
<p><img src="http://img.blog.csdn.net/20170502103501561?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjA1OTc0Nzk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<hr>
<h3 id="数量词的贪婪模式与非贪婪模式"><a href="#数量词的贪婪模式与非贪婪模式" class="headerlink" title="数量词的贪婪模式与非贪婪模式"></a>数量词的贪婪模式与非贪婪模式</h3><blockquote>
<p>正则表达式通常用于在文本中查找匹配的字符串。Python里数量词默认是贪婪的（在少数语言里也可能是默认非贪婪），总是尝试匹配尽可能多的字符；非贪婪的则相反，总是尝试匹配尽可能少的字符。例如：正则表达式”ab<em>”如果用于查找”abbbc”，将找到”abbb”。而如果使用非贪婪的数量词”ab</em>?”，将找到”a”。</p>
</blockquote>
<p>注：一般使用非贪婪模式来提取。</p>
<h3 id="反斜杠问题"><a href="#反斜杠问题" class="headerlink" title="反斜杠问题"></a>反斜杠问题</h3><blockquote>
<p>与大多数编程语言相同，正则表达式里使用”\”作为转义字符，这就可能造成反斜杠困扰。假如你需要匹配文本中的字符”\”，那么使用编程语言表示的正则表达式里将需要4个反斜杠”\\”：前两个和后两个分别用于在编程语言里转义成反斜杠，转换成两个反斜杠后再在正则表达式里转义成一个反斜杠。</p>
</blockquote>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">import re</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">re.compile(string[,flag])  </div><div class="line">#以下为匹配所用函数</div><div class="line">#参数flag是匹配模式，取值可以使用按位或运算符’|’表示同时生效，比如re.I | re.M。</div><div class="line">re.match(pattern, string[, flags])</div><div class="line">re.search(pattern, string[, flags])</div><div class="line">re.split(pattern, string[, maxsplit])</div><div class="line">re.findall(pattern, string[, flags])</div><div class="line">re.finditer(pattern, string[, flags])</div><div class="line">re.sub(pattern, repl, string[, count])</div><div class="line">re.subn(pattern, repl, string[, count])</div></pre></td></tr></table></figure>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">• re.I(全拼：IGNORECASE): 忽略大小写（括号内是完整写法，下同）</div><div class="line">• re.M(全拼：MULTILINE): 多行模式，改变&apos;^&apos;和&apos;$&apos;的行为（参见上图）</div><div class="line">• re.S(全拼：DOTALL): 点任意匹配模式，改变&apos;.&apos;的行为</div><div class="line">• re.L(全拼：LOCALE): 使预定字符类 \w \W \b \B \s \S 取决于当前区域设定</div><div class="line">• re.U(全拼：UNICODE): 使预定字符类 \w \W \b \B \s \S \d \D 取决于unicode定义的字符属性</div><div class="line">• re.X(全拼：VERBOSE): 详细模式。这个模式下正则表达式可以是多行，忽略空白字符，并可以加入注释。</div></pre></td></tr></table></figure>
<hr>
<blockquote>
<p>1.string: 匹配时使用的文本。<br>2.re: 匹配时使用的Pattern对象。<br>3.pos: 文本中正则表达式开始搜索的索引。值与Pattern.match()和Pattern.seach()方法的同名参数相同。<br>4.endpos: 文本中正则表达式结束搜索的索引。值与Pattern.match()和Pattern.seach()方法的同名参数相同。<br>5.lastindex: 最后一个被捕获的分组在文本中的索引。如果没有被捕获的分组，将为None。<br>6.lastgroup: 最后一个被捕获的分组的别名。如果这个分组没有别名或者没有被捕获的分组，将为None。<br>方法：<br>1.group([group1, …]):<br>获得一个或多个分组截获的字符串；指定多个参数时将以元组形式返回。group1可以使用编号也可以使用别名；编号0代表整个匹配的子串；不填写参数时，返回group(0)；没有截获字符串的组返回None；截获了多次的组返回最后一次截获的子串。<br>2.groups([default]):<br>以元组形式返回全部分组截获的字符串。相当于调用group(1,2,…last)。default表示没有截获字符串的组以这个值替代，默认为None。<br>3.groupdict([default]):<br>返回以有别名的组的别名为键、以该组截获的子串为值的字典，没有别名的组不包含在内。default含义同上。<br>4.start([group]):<br>返回指定的组截获的子串在string中的起始索引（子串第一个字符的索引）。group默认值为0。<br>5.end([group]):<br>返回指定的组截获的子串在string中的结束索引（子串最后一个字符的索引+1）。group默认值为0。<br>6.span([group]):<br>返回(start(group), end(group))。<br>7.expand(template):<br>将匹配到的分组代入template中然后返回。template中可以使用\id或\g、\g引用分组，但不能使用编号0。\id与\g是等价的；但\10将被认为是第10个分组，如果你想表达\1之后是字符’0’，只能使用\g0。</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/05/Python学习笔记（一）——-Urllib类库-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dzx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx2.sinaimg.cn/mw690/63b4ac8dgy1ffzs5lll1oj20zk0qoq4z.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dzxblog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/05/Python学习笔记（一）——-Urllib类库-1/" itemprop="url">Python学习笔记（一）—— Urllib类库</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-05T10:23:53+08:00">
                2017-06-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="导入类库"><a href="#导入类库" class="headerlink" title="导入类库"></a>导入类库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">import urllib  </div><div class="line">import urllib2</div></pre></td></tr></table></figure>
<hr>
<h2 id="爬取数据"><a href="#爬取数据" class="headerlink" title="爬取数据"></a>爬取数据</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">request = urllib2.Request(url) #发送请求</div><div class="line">response = urllib2.urlopen(request) #得到响应内容</div><div class="line">response.read() #读取内容</div></pre></td></tr></table></figure>
<h3 id="urlopen"><a href="#urlopen" class="headerlink" title="urlopen()"></a>urlopen()</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># url请求地址</div><div class="line"># data默认为空None</div><div class="line"># timeout默认为socket._GLOBAL_DEFAULT_TIMEOUT</div><div class="line">urlopen(url, data, timeout)</div></pre></td></tr></table></figure>
<h3 id="read"><a href="#read" class="headerlink" title="read()"></a>read()</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 保存返回信息</div><div class="line">response.read()</div></pre></td></tr></table></figure>
<h3 id="构造request"><a href="#构造request" class="headerlink" title="构造request"></a>构造request</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 通过构建一个request，服务器响应请求得到应答</div><div class="line">urllib2.Request(url)</div></pre></td></tr></table></figure>
<h3 id="POST"><a href="#POST" class="headerlink" title="POST"></a>POST</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">values = &#123;&quot;username&quot;:&quot;dzxlar@163.com&quot;,&quot;password&quot;:&quot;XXXX&quot;&#125;</div><div class="line">data = urllib.urlencode(values)</div></pre></td></tr></table></figure>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">values = &#123;&#125;</div><div class="line">values[&apos;username&apos;] = &quot;dzxlar@163.com&quot;</div><div class="line">values[&apos;password&apos;] = &quot;XXXX&quot;</div><div class="line">data = urllib.urlencode(values)</div></pre></td></tr></table></figure>
<h2 id="GET"><a href="#GET" class="headerlink" title="GET"></a>GET</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">values = &#123;&quot;username&quot;:&quot;dzxlar@163.com&quot;,&quot;password&quot;:&quot;XXXX&quot;&#125;</div><div class="line">data = urllib.urlencode(values) </div><div class="line">geturl = url + &quot;?&quot; + data</div></pre></td></tr></table></figure>
<h2 id="设置Headers"><a href="#设置Headers" class="headerlink" title="设置Headers"></a>设置Headers</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">headers = &#123;&#125;</div><div class="line">request = urllib2.Request(url, data, headers)</div></pre></td></tr></table></figure>
<h2 id="设置代理"><a href="#设置代理" class="headerlink" title="设置代理"></a>设置代理</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">proxy_handler = urllib2.ProxyHandler(&#123;&quot;http&quot; : &apos;http://host:port&apos;&#125;)</div><div class="line">null_proxy_handler = urllib2.ProxyHandler(&#123;&#125;)</div><div class="line">if enable_proxy == True:</div><div class="line">    opener = urllib2.build_opener(proxy_handler)</div><div class="line">else:</div><div class="line">    opener = urllib2.build_opener(null_proxy_handler)</div><div class="line">urllib2.install_opener(opener)</div></pre></td></tr></table></figure>
<h2 id="爬虫异常-URLError"><a href="#爬虫异常-URLError" class="headerlink" title="爬虫异常:URLError"></a>爬虫异常:URLError</h2><ul>
<li>网络无连接，即本机无法上网</li>
<li>连接不到特定的服务器</li>
<li>服务器不存在</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">try:</div><div class="line">     # ...</div><div class="line">except urllib2.URLError, e:</div><div class="line">    print e.reason</div></pre></td></tr></table></figure>
<h2 id="HTTPError"><a href="#HTTPError" class="headerlink" title="HTTPError"></a>HTTPError</h2><p>HTTPError是URLError的子类，在你利用urlopen方法发出一个请求时，服务器上都会对应一个应答对象response，其中它包含一个数字”状态码”</p>
<blockquote>
<p>100：继续  客户端应当继续发送请求。客户端应当继续发送请求的剩余部分，或者如果请求已经完成，忽略这个响应。<br>101： 转换协议  在发送完这个响应最后的空行后，服务器将会切换到在Upgrade 消息头中定义的那些协议。只有在切换新的协议更有好处的时候才应该采取类似措施。<br>102：继续处理   由WebDAV（RFC 2518）扩展的状态码，代表处理将被继续执行。<br>200：请求成功      处理方式：获得响应的内容，进行处理<br>201：请求完成，结果是创建了新资源。新创建资源的URI可在响应的实体中得到    处理方式：爬虫中不会遇到<br>202：请求被接受，但处理尚未完成    处理方式：阻塞等待<br>204：服务器端已经实现了请求，但是没有返回新的信 息。如果客户是用户代理，则无须为此更新自身的文档视图。    处理方式：丢弃<br>300：该状态码不被HTTP/1.0的应用程序直接使用， 只是作为3XX类型回应的默认解释。存在多个可用的被请求资源。    处理方式：若程序中能够处理，则进行进一步处理，如果程序中不能处理，则丢弃<br>301：请求到的资源都会分配一个永久的URL，这样就可以在将来通过该URL来访问此资源    处理方式：重定向到分配的URL<br>302：请求到的资源在一个不同的URL处临时保存     处理方式：重定向到临时的URL<br>304：请求的资源未更新     处理方式：丢弃<br>400：非法请求     处理方式：丢弃<br>401：未授权     处理方式：丢弃<br>403：禁止     处理方式：丢弃<br>404：没有找到     处理方式：丢弃<br>500：服务器内部错误  服务器遇到了一个未曾预料的状况，导致了它无法完成对请求的处理。一般来说，这个问题都会在服务器端的源代码出现错误时出现。<br>501：服务器无法识别  服务器不支持当前请求所需要的某个功能。当服务器无法识别请求的方法，并且无法支持其对任何资源的请求。<br>502：错误网关  作为网关或者代理工作的服务器尝试执行请求时，从上游服务器接收到无效的响应。<br>503：服务出错   由于临时的服务器维护或者过载，服务器当前无法处理请求。这个状况是临时的，并且将在一段时间以后恢复。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">try:</div><div class="line">    # ...</div><div class="line">except urllib2.HTTPError, e:</div><div class="line">    print e.code</div><div class="line">    print e.reason</div></pre></td></tr></table></figure>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">try:</div><div class="line">   # ...</div><div class="line">except urllib2.HTTPError, e:</div><div class="line">    print e.code</div><div class="line">except urllib2.URLError, e:</div><div class="line">    print e.reason</div></pre></td></tr></table></figure>
<p><a href="http://cuiqingcai.com/1052.html" target="_blank" rel="external">python2学习教程</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/05/【扩展】RxJava与SpringMVC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dzx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx2.sinaimg.cn/mw690/63b4ac8dgy1ffzs5lll1oj20zk0qoq4z.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dzxblog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/05/【扩展】RxJava与SpringMVC/" itemprop="url">【扩展】RxJava与SpringMVC</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-05T10:22:09+08:00">
                2017-06-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/扩展/" itemprop="url" rel="index">
                    <span itemprop="name">扩展</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="RxJava"><a href="#RxJava" class="headerlink" title="RxJava"></a>RxJava</h3><blockquote>
<p>a library for composing asynchronous and event-based programs by using observable sequences.</p>
<p>是一个使用可观察数据流进行异步编程的编程接口，ReactiveX结合了观察者模式、迭代器模式和函数式编程的精华。与异步数据流交互的编程范式</p>
</blockquote>
<hr>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@RequestMapping(method = RequestMethod.GET, value = &quot;/single&quot;)</div><div class="line">public Single&lt;String&gt; single() &#123;</div><div class="line">    return Single.just(&quot;single value&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@RequestMapping(method = RequestMethod.GET, value = &quot;/singleWithResponse&quot;)</div><div class="line">public ResponseEntity&lt;Single&lt;String&gt;&gt; singleWithResponse() &#123;</div><div class="line">    return new ResponseEntity&lt;&gt;(Single.just(&quot;single value&quot;), HttpStatus.NOT_FOUND);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@RequestMapping(method = RequestMethod.GET, value = &quot;/throw&quot;)</div><div class="line">public Single&lt;Object&gt; error() &#123;</div><div class="line">    return Single.error(new RuntimeException(&quot;Unexpected&quot;));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">@RequestMapping(method = RequestMethod.GET, value = &quot;/single&quot;)</div><div class="line">public Single&lt;String&gt; single() &#123;</div><div class="line">    return Observable.just(&quot;single value&quot;).toSingle();</div><div class="line">&#125;</div><div class="line"></div><div class="line">@RequestMapping(method = RequestMethod.GET, value = &quot;/multiple&quot;)</div><div class="line">public Single&lt;List&lt;String&gt;&gt; multiple() &#123;</div><div class="line">    return Observable.just(&quot;multiple&quot;, &quot;values&quot;).toList().toSingle();</div><div class="line">&#125;</div><div class="line"></div><div class="line">@RequestMapping(method = RequestMethod.GET, value = &quot;/responseWithObservable&quot;)</div><div class="line">public ResponseEntity&lt;Single&lt;String&gt;&gt; responseWithObservable() &#123;</div><div class="line"></div><div class="line">    Observable&lt;String&gt; observable = Observable.just(&quot;single value&quot;);</div><div class="line">    HttpHeaders headers = new HttpHeaders();</div><div class="line">    headers.setContentType(APPLICATION_JSON_UTF8);</div><div class="line">    return new ResponseEntity&lt;&gt;(observable.toSingle(), headers, HttpStatus.CREATED);</div><div class="line">&#125;</div><div class="line"></div><div class="line">@RequestMapping(method = RequestMethod.GET, value = &quot;/timeout&quot;)</div><div class="line">public Observable&lt;String&gt; timeout() &#123;</div><div class="line">    return Observable.timer(1, TimeUnit.MINUTES).map(new Func1&lt;Long, String&gt;() &#123;</div><div class="line">        @Override</div><div class="line">        public String call(Long aLong) &#123;</div><div class="line">            return &quot;single value&quot;;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">@RequestMapping(method = RequestMethod.GET, value = &quot;/sse&quot;)</div><div class="line">public SseEmitter single() &#123;</div><div class="line">    return RxResponse.sse(Observable.just(&quot;single value&quot;));</div><div class="line">&#125;</div><div class="line"></div><div class="line">@RequestMapping(method = RequestMethod.GET, value = &quot;/messages&quot;)</div><div class="line">public SseEmitter messages() &#123;</div><div class="line">    return RxResponse.sse(Observable.just(&quot;message 1&quot;, &quot;message 2&quot;, &quot;message 3&quot;));</div><div class="line">&#125;</div><div class="line"></div><div class="line">@RequestMapping(method = RequestMethod.GET, value = &quot;/events&quot;)</div><div class="line">public SseEmitter event() &#123;</div><div class="line">    return RxResponse.sse(APPLICATION_JSON_UTF8, Observable.just(</div><div class="line">            new EventDto(&quot;Spring io&quot;, getDate(2016, 5, 19)),</div><div class="line">            new EventDto(&quot;SpringOnePlatform&quot;, getDate(2016, 8, 1))</div><div class="line">    ));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/05/【Java核心】泛型简单记录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dzx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx2.sinaimg.cn/mw690/63b4ac8dgy1ffzs5lll1oj20zk0qoq4z.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dzxblog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/05/【Java核心】泛型简单记录/" itemprop="url">【Java核心】泛型简单记录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-05T10:20:41+08:00">
                2017-06-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="泛型记录概要"><a href="#泛型记录概要" class="headerlink" title="泛型记录概要"></a>泛型记录概要</h1><hr>
<p><strong>泛型出现重要原因之一:创造容器类</strong></p>
<p><strong>泛型主要目的之一：指定容器持有什么类型的对象，保证编译的正确性</strong></p>
<h3 id="泛型简单实例"><a href="#泛型简单实例" class="headerlink" title="泛型简单实例"></a>泛型简单实例</h3><pre><code>class GenericsClass&lt;T&gt;{
  private T property;
  public GenericsClass(T property){}
}
</code></pre><h2 id="元组-tuple"><a href="#元组-tuple" class="headerlink" title="元组(tuple)"></a>元组(tuple)</h2><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><blockquote>
<p>又称数据传送对象或者信使。将一组对象直接打包存储于其中的一个单一对象，只允许往这个对象读取其中元素，但是不允许向其中存放新的对象</p>
</blockquote>
<h3 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h3><p><strong>解决仅一次方法调用返回多个对象</strong></p>
<h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><ul>
<li>具有任意长度</li>
<li>存在不同类型的对象</li>
</ul>
<h3 id="简单二维元组"><a href="#简单二维元组" class="headerlink" title="简单二维元组"></a>简单二维元组</h3><pre><code>class TwoTuple&lt;L,R&gt;{
   public final L left;
   public final R right;
   public TwoTuple(L left,R right){
         this.left = left;
         this.right = right;
   }
   public String toString(){
       return &quot;(&quot; + left + &quot;,&quot; + right + &quot;)&quot;;
   }
}
</code></pre><h3 id="通过继承机制创建长度更长的元组"><a href="#通过继承机制创建长度更长的元组" class="headerlink" title="通过继承机制创建长度更长的元组"></a>通过继承机制创建长度更长的元组</h3><pre><code>class ThreeTuple&lt;L,M,R&gt; extends TwoTuple&lt;L,R&gt;{
   public final M middle;
   public TwoTuple(L left,M middle,R right){
         super(left,right);
         this.middle = middle;
   }
   public String toString(){
       return &quot;(&quot; + left + &quot;,&quot; + middle + &quot;,&quot; + right + &quot;)&quot;;
   }
}
</code></pre><h3 id="使用元组"><a href="#使用元组" class="headerlink" title="使用元组"></a>使用元组</h3><pre><code>static TwoTuple&lt;String,Object&gt; getTuple(){
   return new TwoTuple&lt;String,Object&gt;(&quot;key&quot;,&quot;value&quot;);
}

public static void main(String[] args) {
   TwoTuple&lt;String,Object&gt; tuple = getTuple();
   System.out.println(tuple);       
}
</code></pre><h3 id="泛型接口"><a href="#泛型接口" class="headerlink" title="泛型接口"></a>泛型接口</h3><p><strong>生成器(Generator)就是典型的泛型接口应用,用来负责创建对象</strong></p>
<p>生成器(Generator)和工厂模式(FactoryPattern)都是负责创建对象的，两者的区别在于前者不需要传递任何参数信息，后者则需要。</p>
<p>基本类型无法作为类型参数。Java提供的自动打包/拆箱机制转换</p>
<h3 id="泛型方法"><a href="#泛型方法" class="headerlink" title="泛型方法"></a>泛型方法</h3><p><strong>泛型方法可以独立于类发生变化</strong></p>
<pre><code>Class GenericClass{
      public &lt;T&gt; void genericMethod(T x){
           //x.getClass().getName()
      }
}
</code></pre><p><strong>类型参数推断:使用泛型方法不需要指明参数类型，编译器会找出具体类型</strong></p>
<p>杠杆利用类型参数推断</p>
<pre><code>new HashMap&lt;Entity,List&lt;? extends SuperClass&gt;&gt;()

&lt;K,V&gt; Map&lt;K,V&gt;

&lt;T&gt; List&lt;T&gt;
</code></pre><p><strong>类型参数推断避免了重复的泛型参数列表</strong></p>
<p>泛型用于匿名内部类</p>
<p>泛型的好处之一是简单而安全的创建复杂模型</p>
<p>在泛型内部，无法获得任何有关泛型参数类型的信息</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/05/SpringSecurity学习笔记（二）——高级配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dzx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx2.sinaimg.cn/mw690/63b4ac8dgy1ffzs5lll1oj20zk0qoq4z.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dzxblog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/05/SpringSecurity学习笔记（二）——高级配置/" itemprop="url">SpringSecurity学习笔记（二）——高级配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-05T10:16:18+08:00">
                2017-06-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/权限安全/" itemprop="url" rel="index">
                    <span itemprop="name">权限安全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="SpringSecurity学习笔记（二）——-命名空间"><a href="#SpringSecurity学习笔记（二）——-命名空间" class="headerlink" title="SpringSecurity学习笔记（二）—— 命名空间"></a>SpringSecurity学习笔记（二）—— 命名空间</h1><blockquote>
<p>NameSpace：在同一个应用中，为了捕捉最常见使用的框架和提供一个简化的和简洁的语法</p>
</blockquote>
<pre><code>&lt;filter&gt;
    &lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;
&lt;/filter&gt;

&lt;filter-mapping&gt;
    &lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;
</code></pre><hr>
<h3 id="简单的配置"><a href="#简单的配置" class="headerlink" title="简单的配置"></a>简单的配置</h3><pre><code>&lt;http&gt;
  &lt;intercept-url pattern=&quot;/**&quot; access=&quot;hasRole(&apos;USER&apos;)&quot; /&gt;
  &lt;form-login /&gt;
  &lt;logout /&gt;
&lt;/http&gt;
</code></pre><hr>
<h3 id="Session-管理"><a href="#Session-管理" class="headerlink" title="Session 管理"></a>Session 管理</h3><h4 id="session失效时跳转页面"><a href="#session失效时跳转页面" class="headerlink" title="session失效时跳转页面"></a>session失效时跳转页面</h4><pre><code>&lt;http&gt;
    &lt;session-management invalid-session-url=&quot;/invalidSession.htm&quot; /&gt;
&lt;/http&gt;
</code></pre><h4 id="删除cookie"><a href="#删除cookie" class="headerlink" title="删除cookie"></a>删除cookie</h4><pre><code>&lt;http&gt;
    &lt;logout delete-cookies=&quot;JSESSIONID&quot; /&gt;
&lt;/http&gt;
</code></pre><h4 id="一致性session"><a href="#一致性session" class="headerlink" title="一致性session"></a>一致性session</h4><p>1.<br>     <listener><br>        <listener-class><br>            org.springframework.security.web.session.HttpSessionEventPublisher<br>        </listener-class><br>    </listener></p>
<p>2.</p>
<pre><code>&lt;http&gt;
  &lt;session-management&gt;
      &lt;concurrency-control max-sessions=&quot;1&quot; /&gt;
  &lt;/session-management&gt;
&lt;/http&gt;
</code></pre><h4 id="会话攻击保护"><a href="#会话攻击保护" class="headerlink" title="会话攻击保护"></a>会话攻击保护</h4><p>恶意攻击者可以通过访问一个网站创建一个会话,然后说服另一个用户登录使用相同的会话</p>
<p>设置</p>
<pre><code>&lt;session-management session-fixation-protection=&quot;true&quot;&gt;&lt;/session-management&gt;
</code></pre><h4 id="OpenID"><a href="#OpenID" class="headerlink" title="OpenID"></a>OpenID</h4><pre><code>&lt;openid-login /&gt;


OpenIDAuthenticationToken token =
(OpenIDAuthenticationToken)SecurityContextHolder.getContext().getAuthentication();
List&lt;OpenIDAttribute&gt; attributes = token.getAttributes();
</code></pre><hr>
<pre><code>&lt;global-method-security secured-annotations=&quot;enabled&quot; /&gt;
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/05/SpringSecurity学习笔记（一）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="dzx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://wx2.sinaimg.cn/mw690/63b4ac8dgy1ffzs5lll1oj20zk0qoq4z.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="dzxblog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/06/05/SpringSecurity学习笔记（一）/" itemprop="url">SpringSecurity学习笔记（一）—— Java配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-05T09:58:59+08:00">
                2017-06-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/权限安全/" itemprop="url" rel="index">
                    <span itemprop="name">权限安全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="SpringSecurity学习笔记（一）——-Java配置"><a href="#SpringSecurity学习笔记（一）——-Java配置" class="headerlink" title="SpringSecurity学习笔记（一）—— Java配置"></a>SpringSecurity学习笔记（一）—— Java配置</h2><h3 id="目录概要"><a href="#目录概要" class="headerlink" title="目录概要"></a>目录概要</h3><ul>
<li>验证应用程序每一个URL</li>
<li>生成登录表单对象</li>
<li>通过用户/密码进行表单验证</li>
<li>用户注销</li>
<li>阻止CSRF攻击</li>
<li>设置安全请求头</li>
<li>集成servletAPI</li>
</ul>
<h3 id="Web安全"><a href="#Web安全" class="headerlink" title="Web安全"></a>Web安全</h3><blockquote>
<p>创建Security过滤器(通过springSecurityFilterChain负责所有安全过滤请求)</p>
</blockquote>
<p>基本例子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">@EnableWebSecurity</div><div class="line">public class WebSecurityConfiguration extends WebSecurityConfigurerAdapter &#123;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	protected UserDetailsService userDetailsService() &#123;</div><div class="line">		InMemoryUserDetailsManager inMemoryManager = new InMemoryUserDetailsManager();</div><div class="line">		inMemoryManager.createUser(User.withUsername(&quot;admin&quot;).password(&quot;123456&quot;).roles(&quot;SuperAdmin&quot;).build());</div><div class="line">		return inMemoryManager;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">	protected void configure(HttpSecurity http) throws Exception &#123;</div><div class="line">		http.authorizeRequests()</div><div class="line">            //确保任何请求应用程序需要经过身份验证的用户</div><div class="line">		    .anyRequest().authenticated() </div><div class="line">		        .and()</div><div class="line">            //允许用户进行身份验证和基于表单的登录</div><div class="line">	        .formLogin()</div><div class="line">	        	.and()</div><div class="line">            //允许用户通过HTTP基本认证验证</div><div class="line">	        .httpBasic();</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p><strong>AbstractSecurityWebApplicationInitializer确保springSecurityFilterChain得到注册</strong> </p>
<h3 id="Http安全和表单登录"><a href="#Http安全和表单登录" class="headerlink" title="Http安全和表单登录"></a>Http安全和表单登录</h3><hr>
<p>java配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">   @Override</div><div class="line">protected void configure(HttpSecurity http) throws Exception &#123;</div><div class="line">	http.authorizeRequests()</div><div class="line">           //确保任何请求应用程序需要经过身份验证的用户</div><div class="line">	    .anyRequest().authenticated() </div><div class="line">	        .and()</div><div class="line">           //允许用户进行身份验证和基于表单的登录</div><div class="line">        .formLogin()</div><div class="line">        	.and()</div><div class="line">           //允许用户通过HTTP基本认证验证</div><div class="line">        .httpBasic();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<p>xml配置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> &lt;http&gt;</div><div class="line">&lt;intercept-url pattern=&quot;/**&quot; access=&quot;authenticated&quot;/&gt;</div><div class="line">&lt;form-login /&gt;</div><div class="line">&lt;http-basic /&gt;</div><div class="line">&lt;/http&gt;</div></pre></td></tr></table></figure></p>
<h3 id="认证请求"><a href="#认证请求" class="headerlink" title="认证请求"></a>认证请求</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">.authorizeRequests()</div><div class="line">     .antMatchers(&quot;/admin&quot;,&quot;/system&quot;,&quot;/resource&quot;).permitAll()</div><div class="line">     .antMatchers(&quot;/product&quot;).hasRole(&quot;admin&quot;)</div><div class="line">     .antMatchers(&quot;/dba&quot;).access(&quot;hasRole(&apos;admin&apos;) and hasRole(&apos;dba&apos;)&quot;)</div><div class="line">     .anyRequest().authenticated()</div></pre></td></tr></table></figure>
<h3 id="注销"><a href="#注销" class="headerlink" title="注销"></a>注销</h3><ul>
<li>清除http session</li>
<li>清除rememberme状态</li>
<li>清除上下文SecurityContextHolder</li>
<li><p>重定向/login?logout</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">.logout()</div><div class="line">          //如果开启CSRF，请求必须为POST</div><div class="line">       .logoutUrl(&quot;/logout&quot;)</div><div class="line">          //注销成功后，跳转页面</div><div class="line">       .logoutSuccessUrl(&quot;/index&quot;)</div><div class="line">          //清除无效session</div><div class="line">       .invalidateHttpSession(true)</div><div class="line">          //自定义LogoutSuccessHandler.class。如果该类生效。忽略logoutSuccessUrl</div><div class="line"> .logoutSuccessHandler(logoutSuccessHandler)</div><div class="line">          //添加LogoutHandler</div><div class="line">          .addLogoutHandler(logoutHandler)                                         </div><div class="line">          //删除cookie			   </div><div class="line">          .deleteCookies(cookieNamesToClear)</div></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="LogoutSuccessHandler-的实现类"><a href="#LogoutSuccessHandler-的实现类" class="headerlink" title="LogoutSuccessHandler 的实现类"></a>LogoutSuccessHandler 的实现类</h4><blockquote>
<p>注销成功后发生的操作</p>
</blockquote>
<ul>
<li>SimpleUrlLogoutSuccessHandler</li>
<li>HttpStatusReturningLogoutSuccessHandler</li>
</ul>
<h4 id="LogoutHandler-的实现类"><a href="#LogoutHandler-的实现类" class="headerlink" title="LogoutHandler 的实现类"></a>LogoutHandler 的实现类</h4><blockquote>
<p>处理必要的清理。例如cookie等</p>
</blockquote>
<ul>
<li>PersistentTokenBasedRememberMeServices</li>
<li>TokenBasedRememberMeServices</li>
<li>CookieClearingLogoutHandler</li>
<li>CsrfLogoutHandler</li>
<li>SecurityContextLogoutHandler</li>
</ul>
<h4 id="更多关于注销的文档"><a href="#更多关于注销的文档" class="headerlink" title="更多关于注销的文档"></a>更多关于注销的文档</h4><p><a href="http://docs.spring.io/spring-security/site/docs/4.2.3.BUILD-SNAPSHOT/reference/htmlsingle/#nsa-logout" target="_blank" rel="external">&lt; logout &gt;</a></p>
<p><a href="http://docs.spring.io/spring-security/site/docs/4.2.3.BUILD-SNAPSHOT/reference/htmlsingle/#remember-me-impls" target="_blank" rel="external">Remember-Me</a></p>
<p>通过钩子方法实现自动登录。RememberMeServices接口方法类似如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">autoLogin(req,res)</div><div class="line">loginSuccess(req,res)</div><div class="line">loginFail(req,res)</div></pre></td></tr></table></figure></p>
<p><a href="http://docs.spring.io/spring-security/site/docs/4.2.3.BUILD-SNAPSHOT/reference/htmlsingle/#servletapi-logout" target="_blank" rel="external">HttpServletRequest.logout()</a></p>
<blockquote>
<p>用于记录当前用户。HttpServletRequest.logout()被调用,需要编写一个响应。</p>
</blockquote>
<p><a href="http://docs.spring.io/spring-security/site/docs/4.2.3.BUILD-SNAPSHOT/reference/htmlsingle/#ns-logout" target="_blank" rel="external">认证提供者</a></p>
<p><a href="http://docs.spring.io/spring-security/site/docs/4.2.3.BUILD-SNAPSHOT/reference/htmlsingle/#test-logout" target="_blank" rel="external">Test Logout</a></p>
<pre><code>mvc
.perform(logout())
</code></pre><p><a href="http://docs.spring.io/spring-security/site/docs/4.2.3.BUILD-SNAPSHOT/reference/htmlsingle/#cas-singlelogout" target="_blank" rel="external">CAS单点注销</a></p>
<h3 id="高级认证"><a href="#高级认证" class="headerlink" title="高级认证"></a>高级认证</h3><h4 id="In-Memory"><a href="#In-Memory" class="headerlink" title="In-Memory"></a>In-Memory</h4>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@Bean</div><div class="line">   public UserDetailsService userDetailsService() throws Exception &#123;</div><div class="line">  InMemoryUserDetailsManager manager = new InMemoryUserDetailsManager();</div><div class="line">  manager.createUser(User.withUsername(&quot;user&quot;).password(&quot;password&quot;).roles(&quot;USER&quot;).build());</div><div class="line">  manager.createUser(User.withUsername(&quot;admin&quot;).password(&quot;password&quot;).roles(&quot;USER&quot;,&quot;ADMIN&quot;).build());</div><div class="line">  return manager;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h4 id="JDBC"><a href="#JDBC" class="headerlink" title="JDBC"></a>JDBC</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">   @Autowired</div><div class="line">private DataSource dataSource;</div><div class="line"></div><div class="line">@Autowired</div><div class="line">public void configureGlobal(AuthenticationManagerBuilder 	auth) throws Exception &#123;</div><div class="line"> auth</div><div class="line">	.jdbcAuthentication()</div><div class="line">		.dataSource(dataSource)</div><div class="line">		.withDefaultSchema()</div><div class="line">		.withUser(&quot;user&quot;).password(&quot;password&quot;).roles(&quot;USER&quot;).and()</div><div class="line">		.withUser(&quot;admin&quot;).password(&quot;password&quot;).roles(&quot;USER&quot;, &quot;ADMIN&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="自定义授权认证"><a href="#自定义授权认证" class="headerlink" title="自定义授权认证"></a>自定义授权认证</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">   @Bean</div><div class="line">   public SpringAuthenticationProvider springAuthenticationProvider() &#123;</div><div class="line">	 return new SpringAuthenticationProvider();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="自定义身份认证"><a href="#自定义身份认证" class="headerlink" title="自定义身份认证"></a>自定义身份认证</h4><pre><code>@Bean
public SpringDataUserDetailsService springDataUserDetailsService() {
  return new SpringDataUserDetailsService();
}
</code></pre><h4 id="自定义密码加密"><a href="#自定义密码加密" class="headerlink" title="自定义密码加密"></a>自定义密码加密</h4>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"> @Bean</div><div class="line"> public BCryptPasswordEncoder passwordEncoder() &#123;</div><div class="line">return new BCryptPasswordEncoder();</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h3 id="多个HttpSecurity"><a href="#多个HttpSecurity" class="headerlink" title="多个HttpSecurity"></a>多个HttpSecurity</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">   @EnableWebSecurity</div><div class="line">   public class MultiHttpSecurityConfig &#123;</div><div class="line">@Bean</div><div class="line">public UserDetailsService userDetailsService() throws Exception &#123;</div><div class="line">	InMemoryUserDetailsManager manager = new InMemoryUserDetailsManager();</div><div class="line">	manager.createUser(User.withUsername(&quot;user&quot;).password(&quot;password&quot;).roles(&quot;USER&quot;).build());</div><div class="line">	manager.createUser(User.withUsername(&quot;admin&quot;).password(&quot;password&quot;).roles(&quot;USER&quot;,&quot;ADMIN&quot;).build());</div><div class="line">	return manager;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@Configuration</div><div class="line">@Order(1)                                                       1</div><div class="line">public static class ApiWebSecurityConfigurationAdapter extends WebSecurityConfigurerAdapter &#123;</div><div class="line">	protected void configure(HttpSecurity http) throws Exception &#123;</div><div class="line">		http</div><div class="line">			.antMatcher(&quot;/api/**&quot;)                               </div><div class="line">			.authorizeRequests()</div><div class="line">				.anyRequest().hasRole(&quot;ADMIN&quot;)</div><div class="line">				.and()</div><div class="line">			.httpBasic();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@Configuration                                                   </div><div class="line">public static class FormLoginWebSecurityConfigurerAdapter extends WebSecurityConfigurerAdapter &#123;</div><div class="line"></div><div class="line">	@Override</div><div class="line">	protected void configure(HttpSecurity http) throws Exception &#123;</div><div class="line">		http</div><div class="line">			.authorizeRequests()</div><div class="line">				.anyRequest().authenticated()</div><div class="line">				.and()</div><div class="line">			.formLogin();</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h3 id="方法安全"><a href="#方法安全" class="headerlink" title="方法安全"></a>方法安全</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@EnableGlobalMethodSecurity(securedEnabled = true)</div><div class="line">public class MethodSecurityConfig &#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public interface BankService &#123;</div><div class="line"></div><div class="line"> @Secured(&quot;IS_AUTHENTICATED_ANONYMOUSLY&quot;)</div><div class="line"> public Account readAccount(Long id);</div><div class="line"></div><div class="line"> @Secured(&quot;IS_AUTHENTICATED_ANONYMOUSLY&quot;)</div><div class="line"> public Account[] findAccounts();</div><div class="line"></div><div class="line"> @Secured(&quot;ROLE_TELLER&quot;)</div><div class="line"> public Account post(Account account, double amount);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="后置处理"><a href="#后置处理" class="headerlink" title="后置处理"></a>后置处理</h3>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">.withObjectPostProcessor(new ObjectPostProcessor&lt;FilterSecurityInterceptor&gt;() &#123;</div><div class="line">	public &lt;O extends FilterSecurityInterceptor&gt; O postProcess(</div><div class="line">			O fsi) &#123;</div><div class="line">		fsi.setPublishAuthorizationSuccess(true);</div><div class="line">		return fsi;</div><div class="line">	&#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<h3 id="自定义DSLs"><a href="#自定义DSLs" class="headerlink" title="自定义DSLs"></a>自定义DSLs</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">   public class MyCustomDsl extends AbstractHttpConfigurer&lt;CorsConfigurerMyCustomDsl, HttpSecurity&gt; &#123;</div><div class="line">private boolean flag;</div><div class="line"></div><div class="line">@Override</div><div class="line">public void init(H http) throws Exception &#123;</div><div class="line">	// any method that adds another configurer</div><div class="line">	// must be done in the init method</div><div class="line">	http.csrf().disable();</div><div class="line">&#125;</div><div class="line"></div><div class="line">@Override</div><div class="line">public void configure(H http) throws Exception &#123;</div><div class="line">	ApplicationContext context = http.getSharedObject(ApplicationContext.class);</div><div class="line"></div><div class="line">	// here we lookup from the ApplicationContext. You can also just create a new instance.</div><div class="line">	MyFilter myFilter = context.getBean(MyFilter.class);</div><div class="line">	myFilter.setFlag(flag);</div><div class="line">	http.addFilterBefore(myFilter, UsernamePasswordAuthenticationFilter.class);</div><div class="line">&#125;</div><div class="line"></div><div class="line">public MyCustomDsl flag(boolean value) &#123;</div><div class="line">	this.flag = value;</div><div class="line">	return this;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public static MyCustomDsl customDsl() &#123;</div><div class="line">	return new MyCustomDsl();</div><div class="line">&#125;		</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>META-INF/spring.factories.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">org.springframework.security.config.annotation.web.configurers.AbstractHttpConfigurer = sample.MyCustomDsl</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/11/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/13/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://wx2.sinaimg.cn/mw690/63b4ac8dgy1ffzs5lll1oj20zk0qoq4z.jpg"
               alt="dzx" />
          <p class="site-author-name" itemprop="name">dzx</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">122</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">45</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">97</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">dzx</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

  

</body>
</html>
